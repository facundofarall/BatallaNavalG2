################################################################################
#                                                                              #
#    Micro Series 6801 Assembler V2.00/DOS              28/Nov/17  10:28:44    #
#                                                                              #
#       Source   =   main_bn.msa                                               #
#       List     =   main_bn.lst                                               #
#       Object   =   main_bn.r07                                               #
#       Options  =                                                             #
#                                                                              #
#                                               (c) Copyright IAR Systems 1990 #
################################################################################


    1  0000                           p68h11
    2                 $macros.msa
    3                 **********************************
    4                 * definicion de macro utilizados *
    5                 **********************************
    6                 * limpia display bitmap
    7  0000                           MACRO   %CLS
    8                                 
    9                                 ldx             #display
   10                                 ldaa            #ARRAY_L
   11                                 ldab            #$03
   12                 cls\@           stab            0,X
   13                                 inx
   14                                 deca
   15                                 bne             cls\<
   16                 
   17  0000                           ENDMAC
   18                 
   19                 * espera
   20  0000                           MACRO   %EXPECT
   21                                 
   22                 expe\@          jsr             read_kb
   23                                 tsta
   24                                 bmi             expe\.
   25                                 cmpa            #\0
   26                                 bne             expe\<
   27                 
   28  0000                           ENDMAC
   29                 
   30                 * soltar
   31  0000                           MACRO   %KEEP
   32                                 
   33                 keep\@          jsr             read_kb
   34                                 cmpa            #\0
   35                                 beq             keep\<
   36                 
   37  0000                           ENDMAC
   38                 * filter array auxiliar
   39  0000                           MACRO   %FIX_ARRY
   40                 
   41                                 ldx             SA_MAT,Y
   42                                 ldaa            #ARRAY_L
   43                 loop\@          ldab            0,X
   44                                 andb            #11000000b
   45                                 orab            #00000011b
   46                                 stab            0,X
   47                                 inx
   48                                 deca
   49                                 bne             loop\<
   50                 
   51  0000                           ENDMAC
   52                 
   53                 * clear array auxiliar
   54  0000                           MACRO   %CLR_AUX
   55                                 
   56                                 ldx             #arry_aux
   57                                 ldaa            #N_AUX*SA_SIZE
   58                                 ldab            #0
   59                                 jsr             clrarray
   60                 
   61  0000                           ENDMAC
   62                 
   63                 * para ir actualizando el display
   64  0000                           MACRO   %REFRESH
   65                 
   66                                 pshy
   67                                 ldx             SA_MAT,Y
   68                                 pshx
   69                                 clra
   70                                 psha
   71                                 ldy             #display
   72                                 pshy
   73                                 ldaa            #ARRAY_L
   74                                 psha
   75                                 jsr             mirror
   76                                 pula
   77                                 puly
   78                                 pula
   79                                 pulx
   80                                 puly    
   81                 
   82  0000                           ENDMAC
   83                 
   84                 * saltos que pasan el limite
   85  0000                           MACRO   %GOTO
   86                 
   87                                 jmp     \0
   88                 
   89  0000                           ENDMAC
   90                 
   91                 * agrega posicion al arreglo de posiciones prohibidas
   92                 * toma en A la fila y en B la columna
   93  0000                           MACRO   %PROH_POS
   94                                 
   95                                 tsta
   96                                 bne             oka\@
   97                                 ldaa            #$FF
   98                 oka\<           tstb
   99                                 bne             okb\@
  100                                 ldab            #$FF
  101                 okb\<           psha
  102                                 pshb
  103                                 ldx             #arry_pr
  104                                 pshx
  105                                 clra
  106                                 psha
  107                                 jsr             play_wrt
  108                                 pula
  109                                 pulx
  110                                 pulb
  111                                 pula
  112                 
  113  0000                           ENDMAC
  114                 
  115                 * agrega las posiciones de la periferia de una posicion al arreglo
  116                 * de prohibidas, tomando en A la fila y en B la columna de dicha posicion
  117                 
  118  0000                           MACRO   %PROH_PER
  119                                         
  120                                 inca
  121                                 %PROH_POS
  122                         
  123                                 deca
  124                                 incb
  125                                 %PROH_POS
  126                 
  127                                 deca
  128                                 decb
  129                                 %PROH_POS
  130                 
  131                                 inca
  132                                 decb
  133                                 %PROH_POS
  134                 
  135  0000                           ENDMAC
  136                 
  137                 * escribe una posicion en la matriz del tablero y toma
  138                 * por A como fila y B como columna de dicha posicion
  139                 * el parametro \0 indica que tipo de barco es el grabado
  140                 
  141  0000                           MACRO   %SET_POS
  142                 
  143                                 ldaa            #\0
  144                                 psha
  145                                 ldaa            SA_FIL,Y
  146                                 psha
  147                                 ldab            SA_COL,Y
  148                                 pshb
  149                                 ldx             SA_MAT,Y
  150                                 pshx
  151                                 clra
  152                                 psha
  153                                 jsr             writepos
  154                                 pula
  155                                 pulx
  156                                 pulb
  157                                 pula
  158                                 pula
  159                 
  160  0000                           ENDMAC
  161                 
  162                 * me fijo que la posicion este o no este en el arreglo de posiciones
  163                 * prohibidas, la A se toma como la fila y la B como la columna
  164                 
  165  0000                           MACRO   %IS_PROH
  166                 
  167                                 psha
  168                                 pshb
  169                                 ldx             #arry_pr
  170                                 pshx
  171                                 clra
  172                                 psha
  173                                 jsr             play_src
  174                                 pula
  175                                 pulx
  176                                 pulb
  177                                 pula
  178                 
  179  0000                           ENDMAC
  180                 
  181                 * agrego una posicion al arreglo auxiliar para cargueros
  182                 * y se toma que en A esta la fila y en B la columna
  183                 
  184  0000                           MACRO   %AUX_POS
  185                 
  186                                 psha
  187                                 pshb
  188                                 ldx             #arry_aux
  189                                 pshx
  190                                 clra
  191                                 psha
  192                                 jsr             play_wrt
  193                                 pula
  194                                 pulx
  195                                 pulb
  196                                 pula
  197                 
  198  0000                           ENDMAC
  199                 
  200                 * establezco el arreglo auxiliar con las posiciones
  201                 * perifericas del carguero, toma en A fila y B columna
  202                 * de la parte uno del carguero
  203                 
  204  0000                           MACRO   %SET_AUX
  205                                 
  206                                 inca
  207                                 %AUX_POS
  208                                 
  209                                 deca
  210                                 incb
  211                                 %AUX_POS
  212                                 
  213                                 deca
  214                                 decb
  215                                 %AUX_POS
  216                 
  217                                 inca
  218                                 decb
  219                                 %AUX_POS                
  220                 
  221  0000                           ENDMAC
  222                 
  223                 * invocar a la subrutina writepos
  224  0000                   MACRO   %WRITEPOS
  225                                 ldab            \0
  226                                 pshb                            ;se envía el byte a escribir
  227                                 ldab            12,x
  228                                 pshb                            ;se envía letra (fila)
  229                                 ldab            11,x
  230                                 pshb                            ;se envía num (columna)
  231                                 ldy             9,x
  232                                 pshy                            ;se envía dirección de inicio de matriz
  233                                 ldab            8,x
  234                                 pshb                            ;se envía jugador atacado
  235                                 jsr             writepos
  236                                 %CLRST          6
  237  0000                   ENDMAC
  238                 
  239                 * invocar a la subrutina writepos
  240  0000                   MACRO   %PLAY_WRT
  241                                 ldab            12,x
  242                                 pshb                            ;se envía letra (fila)
  243                                 ldab            11,x
  244                                 pshb                            ;se envía num (columna)
  245                                 ldy             14,x
  246                                 pshy                            ;se envía inicio de array
  247                                 ldab            8,x
  248                                 pshb                            ;se envía jugador atacado
  249                                 jsr             play_wrt
  250                                 %CLRST          5
  251  0000                   ENDMAC
  252                 
  253                 * realizar back up de AccA, AccB, IX e IY
  254  0000                   MACRO   %BACKUP
  255                                 psha
  256                                 pshb
  257                                 pshx
  258                                 pshy
  259  0000                   ENDMAC
  260                 
  261                 * realizar restore de AccA, AccB, IX e IY
  262  0000                   MACRO   %RESTORE
  263                                 puly
  264                                 pulx
  265                                 pulb
  266                                 pula
  267  0000                   ENDMAC
  268                 
  269                 * limpiar el stack de datos enviados
  270  0000                   MACRO   %CLRST
  271                 CONT_M          SET     \0
  272                                 IF CONT_M > 0
  273                                 ins
  274                                 %CLRST  CONT_M-1
  275                                 ENDIF
  276  0000                   ENDMAC
  277                 * activar un led en funcion de una variable
  278  0000                   MACRO   %LED_INV
  279                                 ldaa            PORTA
  280                                 eora            #SHF_LED
  281                                 staa            PORTA
  282  0000                   ENDMAC
  283                 
  284                 * declarar o reservar variables locales en subrutinas
  285  0000                   MACRO   %MALLOC
  286                                 IF \0 > 0
  287                                 tsx
  288                                 xgdx
  289                                 subd    #\0
  290                                 xgdx
  291                                 txs
  292                                 ENDIF
  293  0000                   ENDMAC
  294                 
  295                 * liberar espacio de variables en subrutinas
  296  0000                   MACRO   %RELMEM
  297                                 IF \0 > 0
  298                                 tsx
  299                                 xgdx
  300                                 addd    #\0
  301                                 xgdx
  302                                 txs
  303                                 ENDIF           
  304  0000                   ENDMAC
  305                 
  306                 *************
  307                 * CONSTANTS *
  308                 *************
  309  0000           P1              EQU             0
  310  0001           P2              EQU             1
  311  0002           PN              EQU             2               ;cantidad de jugadores
  312                 
  313  0006           MAX_C           EQU             6
  314  0001           MIN_C           EQU             1
  315  000F           MAX_F           EQU             15
  316  000A           MIN_F           EQU             10              
  317                 
  318  0003           WAT_NP          EQU             00000011b
  319  0043           SUB_NP          EQU             01000011b
  320  0083           SHI_NP          EQU             10000011b
  321  0008           WATER           EQU             00001000b       ;verde
  322  0050           SUNK_SUB        EQU             01010000b       ;bordeaux para submarinos
  323  00B0           HIT             EQU             10110000b       ;naranja
  324  0090           SUNK_SHI        EQU             10010000b       ;bordeaux para cargueros
  325                 
  326  0006           FILA            EQU             6
  327  0006           COL             EQU             6
  328  0024           ARRAY_L         EQU             FILA*COL
  329  000A           NORM            EQU             10
  330                 
  331  000A           MIN_FIL         EQU             10
  332  000F           MAX_FIL         EQU             15
  333  0001           MIN_COL         EQU             1
  334  0006           MAX_COL         EQU             6       
  335                 
  336  0000           CONT            EQU             0
  337  0002           FILA_L          EQU             2
  338  0001           COL_L           EQU             1
  339                 
  340  0003           INPUTS          EQU             3
  341                 
  342  FFFF           NONE            EQU             -1
  343  0003           MASK_FIL        EQU             3
  344  0002           MASK_COL        EQU             2
  345  0001           COL_CONT        EQU             1
  346  0000           KB_PRESS        EQU             0
  347                 
  348                 ******* Ports ***************************
  349                 
  350  1007           DDRC            EQU             $1007           ;data direction register for C
  351  1002           PIOC            EQU             $1002           ;for strobe B assertion change
  352  1005           PORTCL          EQU             $1005           ;port C latched
  353  1004           PORTB           EQU             $1004           ;port B
  354  1003           PORTC           EQU             $1003           ;rows
  355  1000           PORTA           EQU             $1000
  356                 
  357  0040           SHF_LED         EQU             $40
  358                 
  359                 ******* Cols and Row Ports **************
  360                 
  361  1003           ROWS            EQU             PORTC           ;outputs
  362  1005           COLS            EQU             PORTCL          ;inputs
  363                 
  364                 ***** Col Mask **************************
  365  0010           COL0            EQU             00010000b
  366                          
  367                 ***** Row Masks *************************
  368                 
  369  000E           FIL0            EQU             00001110b       ;mascaras para manejo de filas
  370  000D           FIL1            EQU             00001101b
  371  000B           FIL2            EQU             00001011b
  372  0007           FIL3            EQU             00000111b
  373                 
  374  0004           LENGTH          EQU             4               ; largo del display
  375                 
  376                 ****** Keyboard Mask ********************
  377  0008           Button_1        EQU             8
  378  0009           Button_2        EQU             9
  379  000A           Button_3        EQU             10
  380  000C           Button_4        EQU             12
  381  000D           Button_5        EQU             13
  382  000E           Button_6        EQU             14              
  383  0000           Button_A        EQU             0       
  384  0001           Button_B        EQU             1
  385  0002           Button_C        EQU             2
  386  0004           Button_D        EQU             4
  387  0005           Button_E        EQU             5
  388  0006           Button_F        EQU             6
  389  000B           B_fire          EQU             11
  390  0003           B_P1            EQU             3
  391  0007           B_P2            EQU             7
  392  000F           B_reset         EQU             15
  393                 
  394  0000           EOT             EQU             0
  395  0020           ESP             EQU             $20     
  396                 
  397                 *========================================================
  398                 * El siguiente es un programa de un juego de batalla
  399                 * naval para dos jugadores en el emulador Wookie FX.
  400                 *========================================================
  401                 
  402                 ****************
  403                 * MAIN PROGRAM *
  404                 ****************
  405                 
  406  2000                           ORG             $2000
  407  2000           init            EQU             *
  408  2000 8E4257                    lds             #STACKP
  409                 
  410                 * INICIALIZAR DISPLAY Y TECLADO
  411  2003 BD298B                    jsr             initdis         ;inicialización de display 7 seg
  412  2006 BD2983                    jsr             init_kb         ;inicialización de teclado
  413                 
  414                 * LIMPIAR ARREGLO DE BARCOS ATACADOS
  415  2009 CE4284                    ldx             #hitlist
  416  200C 3C                        pshx                            ;se envía inicio de arreglo de barcos a poner en 0
  417  200D 8636                      ldaa            #(HITSIZE*2)
  418  200F 36                        psha                            ;se envía el tamaño del arreglo a limpiar
  419  2010 BD2821                    jsr             clrzone
  420  2013                           %CLRST          3
    /  0003           CONT_M          SET     3
    /  2013                           IF CONT_M > 0
    /  2013 31                        ins
    /  2014                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2014                           IF CONT_M > 0
    /  2014 31                        ins
    /  2015                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2015                           IF CONT_M > 0
    /  2015 31                        ins
    /  2016                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2016                           ENDIF
    /  2016                           ENDIF
    /  2016                           ENDIF
    /  2016                           ENDIF
  421                 
  422                 * DEFINIR CANTIDAD DE BARCOS A UTILIZAR
  423  2016 BD26BE                    jsr             def_ships
  424  2019 B6425B                    ldaa            cant_sub        ;se carga cantidad de submarinos
  425  201C F6425C                    ldab            cant_shi        ;se carga cantidad de cargueros
  426  201F 58                        lslb                            ;se multiplica a la cantidad de cargueros por dos, así se obtiene las posiciones atacables
  427  2020 1B                        aba
  428  2021 B7425D                    staa            tot_pos         ;se carga la variable con el total de posiciones atacables
  429                 
  430                 * DEFINIR BARCOS P1
  431  2024 B6425C                    ldaa            cant_shi
  432  2027 36                        psha                            ;se envía cantidad de cargueros
  433  2028 B6425B                    ldaa            cant_sub
  434  202B 36                        psha                            ;se envía cantidad de submarinos
  435  202C CE5000                    ldx             #p_board
  436  202F 3C                        pshx                            ;se envía el inicio del tablero de P1
  437  2030 BD2106                    jsr             setarmy
  438  2033                           %CLRST          4
    /  0004           CONT_M          SET     4
    /  2033                           IF CONT_M > 0
    /  2033 31                        ins
    /  2034                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2034                           IF CONT_M > 0
    /  2034 31                        ins
    /  2035                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2035                           IF CONT_M > 0
    /  2035 31                        ins
    /  2036                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2036                           IF CONT_M > 0
    /  2036 31                        ins
    /  2037                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2037                           ENDIF
    /  2037                           ENDIF
    /  2037                           ENDIF
    /  2037                           ENDIF
    /  2037                           ENDIF
  439                 
  440                 * DEFINIR BARCOS P2
  441  2037 B6425C                    ldaa            cant_shi
  442  203A 36                        psha                            ;se envía cantidad de cargueros
  443  203B B6425B                    ldaa            cant_sub
  444  203E 36                        psha                            ;se envía cantidad de submarinos
  445  203F CE5000                    ldx             #p_board        ;se toma la dirección al tablero de P1
  446  2042 C624                      ldab            #ARRAY_L
  447  2044 3A                        abx                             ;se desfasa al tablero de P2
  448  2045 3C                        pshx                            ;se envía el inicio del tablero de P2
  449  2046 BD2106                    jsr             setarmy
  450  2049                           %CLRST          4
    /  0004           CONT_M          SET     4
    /  2049                           IF CONT_M > 0
    /  2049 31                        ins
    /  204A                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  204A                           IF CONT_M > 0
    /  204A 31                        ins
    /  204B                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  204B                           IF CONT_M > 0
    /  204B 31                        ins
    /  204C                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  204C                           IF CONT_M > 0
    /  204C 31                        ins
    /  204D                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  204D                           ENDIF
    /  204D                           ENDIF
    /  204D                           ENDIF
    /  204D                           ENDIF
    /  204D                           ENDIF
  451                 
  452  204D           main            EQU             *
  453                 * ELEGIR JUGADOR
  454  204D BD2839                    jsr             whoplays        ;se recibirá en AccA el jugador a atacar a continuación
  455  2050 B74258                    staa            player          ;se habilita la siguiente jugada
  456                 
  457                 * ENVIAR TABLERO DE JUGADOR A ATACAR A DISPLAY
  458  2053 CE5000                    ldx             #p_board
  459  2056 3C                        pshx                            ;se envía el inicio de las matrices de tableros
  460  2057 B64258                    ldaa            player
  461  205A 36                        psha                            ;se envía el jugador atacado
  462  205B CE5F00                    ldx             #display
  463  205E 3C                        pshx                            ;se envía la matriz de display (destino a copiar)
  464  205F 8624                      ldaa            #ARRAY_L
  465  2061 36                        psha                            ;se envía el tamaño de la matriz tablero
  466  2062 BD2715                    jsr             mirror          ;se envía el tablero del jugador atacado al display
  467  2065                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  2065                           IF CONT_M > 0
    /  2065 31                        ins
    /  2066                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  2066                           IF CONT_M > 0
    /  2066 31                        ins
    /  2067                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2067                           IF CONT_M > 0
    /  2067 31                        ins
    /  2068                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2068                           IF CONT_M > 0
    /  2068 31                        ins
    /  2069                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2069                           IF CONT_M > 0
    /  2069 31                        ins
    /  206A                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  206A                           IF CONT_M > 0
    /  206A 31                        ins
    /  206B                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  206B                           ENDIF
    /  206B                           ENDIF
    /  206B                           ENDIF
    /  206B                           ENDIF
    /  206B                           ENDIF
    /  206B                           ENDIF
    /  206B                           ENDIF
  468                 
  469                 * INGRESAR POSICIÓN A ATACAR
  470  206B BD284E                    jsr             input           ;se llama a la subrutina de interfaz de usuario
  471  206E B74259                    staa            letra_p         ;se recibe en AccA la letra jugada (fila) y en AccB el número (columna)
  472  2071 F7425A                    stab            num_p           ;se guarda la jugada
  473                 
  474                 * VERIFICAR QUE NO SEA POSICIÓN DE BARCO YA ATACADA
  475  2074 B64259                    ldaa            letra_p
  476  2077 36                        psha                            ;se envía la letra jugada
  477  2078 F6425A                    ldab            num_p
  478  207B 37                        pshb                            ;se envía el número jugado
  479  207C CE4284                    ldx             #hitlist
  480  207F 3C                        pshx                            ;se envía la posición del primer arreglo de barcos tocados
  481  2080 B64258                    ldaa            player
  482  2083 36                        psha                            ;se envía el jugador a atacar
  483  2084 BD27A0                    jsr             play_src        ;se recibirá el carry en 1 si la posición corresponde a un barco ya atacado
  484  2087                           %CLRST          5               ;se limpia el stack
    /  0005           CONT_M          SET     5
    /  2087                           IF CONT_M > 0
    /  2087 31                        ins
    /  2088                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2088                           IF CONT_M > 0
    /  2088 31                        ins
    /  2089                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2089                           IF CONT_M > 0
    /  2089 31                        ins
    /  208A                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  208A                           IF CONT_M > 0
    /  208A 31                        ins
    /  208B                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  208B                           IF CONT_M > 0
    /  208B 31                        ins
    /  208C                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  208C                           ENDIF
    /  208C                           ENDIF
    /  208C                           ENDIF
    /  208C                           ENDIF
    /  208C                           ENDIF
    /  208C                           ENDIF
  485  208C 25BF                      bcs             main            ;si la posición ya fue jugada, se pierde el turno y pasa al siguiente
  486                 
  487                 * MANDAR QUE JUGADOR ESTÁ JUGANDO AL DISPLAY
  488  208E B64258                    ldaa            player
  489  2091 36                        psha                            ;se envía el jugador que está siendo atacado
  490  2092 BD29F5                    jsr             turn
  491  2095                           %CLRST          1
    /  0001           CONT_M          SET     1
    /  2095                           IF CONT_M > 0
    /  2095 31                        ins
    /  2096                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2096                           ENDIF
    /  2096                           ENDIF
  492                 
  493                 * BUSCAR EL BYTE ATACADO EN EL TABLERO DEL JUGADOR ATACADO
  494  2096 B64259                    ldaa            letra_p
  495  2099 36                        psha                            ;se envía le letra jugada
  496  209A F6425A                    ldab            num_p
  497  209D 37                        pshb                            ;se envía el número jugado
  498  209E CE5000                    ldx             #p_board
  499  20A1 3C                        pshx                            ;se envía la dirección de inicio de los arreglos de tablero
  500  20A2 F64258                    ldab            player
  501  20A5 37                        pshb                            ;se envía el jugador a atacar
  502  20A6 BD273E                    jsr             fetchpos
  503  20A9                           %CLRST          4               ;se limpia el stack
    /  0004           CONT_M          SET     4
    /  20A9                           IF CONT_M > 0
    /  20A9 31                        ins
    /  20AA                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  20AA                           IF CONT_M > 0
    /  20AA 31                        ins
    /  20AB                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  20AB                           IF CONT_M > 0
    /  20AB 31                        ins
    /  20AC                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  20AC                           IF CONT_M > 0
    /  20AC 31                        ins
    /  20AD                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  20AD                           ENDIF
    /  20AD                           ENDIF
    /  20AD                           ENDIF
    /  20AD                           ENDIF
    /  20AD                           ENDIF
  504  20AD 32                        pula                            ;se toma del stack el dato del byte jugado
  505                 
  506                 * ATACAR
  507  20AE CE4284                    ldx             #hitlist
  508  20B1 3C                        pshx                            ;se envía inicio del arreglo de barcos atacados
  509  20B2 36                        psha                            ;se envía el byte a jugado
  510  20B3 B64259                    ldaa            letra_p
  511  20B6 36                        psha                            ;se envía le letra jugada
  512  20B7 F6425A                    ldab            num_p
  513  20BA 37                        pshb                            ;se envía el número jugado
  514  20BB CE5000                    ldx             #p_board
  515  20BE 3C                        pshx                            ;se envía la dirección de inicio de los arreglos de tablero
  516  20BF F64258                    ldab            player
  517  20C2 37                        pshb                            ;se envía el jugador a atacar
  518  20C3 BD2456                    jsr             gameplay
  519  20C6                           %CLRST          8               ;se limpia el stack
    /  0008           CONT_M          SET     8
    /  20C6                           IF CONT_M > 0
    /  20C6 31                        ins
    /  20C7                           %CLRST  CONT_M-1
    /  0007           CONT_M          SET     CONT_M-1
    /  20C7                           IF CONT_M > 0
    /  20C7 31                        ins
    /  20C8                           %CLRST  CONT_M-1
    /  0006           CONT_M          SET     CONT_M-1
    /  20C8                           IF CONT_M > 0
    /  20C8 31                        ins
    /  20C9                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  20C9                           IF CONT_M > 0
    /  20C9 31                        ins
    /  20CA                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  20CA                           IF CONT_M > 0
    /  20CA 31                        ins
    /  20CB                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  20CB                           IF CONT_M > 0
    /  20CB 31                        ins
    /  20CC                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  20CC                           IF CONT_M > 0
    /  20CC 31                        ins
    /  20CD                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  20CD                           IF CONT_M > 0
    /  20CD 31                        ins
    /  20CE                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
    /  20CE                           ENDIF
  520                 
  521                 * ACTUALIZAR DISPLAY CON LA POSICIÓN YA ATACADA
  522  20CE CE5000                    ldx             #p_board
  523  20D1 3C                        pshx                            ;se envía el inicio de las matrices de tableros
  524  20D2 B64258                    ldaa            player
  525  20D5 36                        psha                            ;se envía el jugador atacado
  526  20D6 CE5F00                    ldx             #display
  527  20D9 3C                        pshx                            ;se envía la matriz de display (destino a copiar)
  528  20DA 8624                      ldaa            #ARRAY_L
  529  20DC 36                        psha                            ;se envía el tamaño de la matriz tablero
  530  20DD BD2715                    jsr             mirror          ;se envía el tablero del jugador atacado al display
  531  20E0                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  20E0                           IF CONT_M > 0
    /  20E0 31                        ins
    /  20E1                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  20E1                           IF CONT_M > 0
    /  20E1 31                        ins
    /  20E2                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  20E2                           IF CONT_M > 0
    /  20E2 31                        ins
    /  20E3                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  20E3                           IF CONT_M > 0
    /  20E3 31                        ins
    /  20E4                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  20E4                           IF CONT_M > 0
    /  20E4 31                        ins
    /  20E5                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  20E5                           IF CONT_M > 0
    /  20E5 31                        ins
    /  20E6                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  20E6                           ENDIF
    /  20E6                           ENDIF
    /  20E6                           ENDIF
    /  20E6                           ENDIF
    /  20E6                           ENDIF
    /  20E6                           ENDIF
    /  20E6                           ENDIF
  532                 
  533                 * CONTAR BARCOS ATACADOS A VER SI EL JUGADOR GANÓ               
  534  20E6 CE4284                    ldx             #hitlist
  535  20E9 3C                        pshx                            ;se envía la posición del primer arreglo de barcos tocados
  536  20EA B64258                    ldaa            player
  537  20ED 36                        psha                            ;se envía el jugador a atacar
  538  20EE BD27D3                    jsr             play_cnt
  539  20F1                           %CLRST          2
    /  0002           CONT_M          SET     2
    /  20F1                           IF CONT_M > 0
    /  20F1 31                        ins
    /  20F2                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  20F2                           IF CONT_M > 0
    /  20F2 31                        ins
    /  20F3                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  20F3                           ENDIF
    /  20F3                           ENDIF
    /  20F3                           ENDIF
  540  20F3 32                        pula                            ;se recibe la cantidad de bytes contados
  541  20F4 B1425D                    cmpa            tot_pos         
  542  20F7 2703                      beq             end_game        ;si se llegó al máximo de barcos, se termina el juego
  543                 
  544  20F9 7E204D                    jmp             main
  545                 
  546                 * MANDAR MENSAJE A DISPLAY DE QUIÉN GANÓ
  547  20FC           end_game        EQU             *
  548  20FC B64258                    ldaa            player
  549  20FF 36                        psha
  550  2100 BD29D7                    jsr             winner
  551  2103                           %CLRST          1
    /  0001           CONT_M          SET     1
    /  2103                           IF CONT_M > 0
    /  2103 31                        ins
    /  2104                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2104                           ENDIF
    /  2104                           ENDIF
  552                 
  553  2104           end_loop        EQU             *
  554  2104 20FE                      bra             end_loop
  555                 
  556                 **************
  557                 * SUBRUTINES *
  558                 **************
  559                 
  560                 *--------------------------------------------
  561                 * setarmy: subrutina para definir los barcos
  562                 *          de cada usuario
  563                 *
  564                 * parametros: Push cantidad de cargueros
  565                 *             Push cantidad de submarinos
  566                 *             Push direccion matriz tablero
  567                 *--------------------------------------------
  568                 
  569  0003           CH_TYPE         EQU             3
  570                 
  571  0002           SA_SIZE         EQU             2
  572  0064           N_PR            EQU             100
  573  0004           N_AUX           EQU             4
  574                 
  575  0000           SA_FIL          EQU             0
  576  0001           SA_COL          EQU             1
  577  0002           SA_CARG         EQU             2
  578  0003           SA_CONT         EQU             3
  579  0004           SA_TOT          EQU             4
  580  000D           SA_MAT          EQU             13
  581  000F           SA_CSUB         EQU             15
  582  0010           SA_CSHI         EQU             16
  583                 
  584  0040           BY_SUB          EQU             01000000b
  585  0080           BY_SHI          EQU             10000000b
  586                 
  587  2106           setarmy         EQU             *
  588                 
  589                 * back up de registros
  590  2106 36                        psha
  591  2107 37                        pshb
  592  2108 3C                        pshx
  593  2109 183C                      pshy
  594                 
  595                 * variables locales
  596  210B 36                        psha
  597  210C 36                        psha
  598  210D 36                        psha
  599  210E 36                        psha
  600  210F 36                        psha
  601                 
  602                 * inializo el framepointer
  603  2110 1830                      tsy
  604                 
  605                 * inicializo los contadores
  606  2112 186F03                    clr             SA_CONT,Y
  607  2115 186F02                    clr             SA_CARG,Y
  608  2118 18A60F                    ldaa            SA_CSUB,Y
  609  211B 18E610                    ldab            SA_CSHI,Y
  610  211E 1B                        aba
  611  211F 18A704                    staa            SA_TOT,Y
  612                 
  613                 * inicializo arreglos
  614  2122 CE42D8                    ldx             #arry_pr
  615  2125 86C8                      ldaa            #N_PR*SA_SIZE
  616  2127 C600                      ldab            #0
  617  2129 BD29CC                    jsr             clrarray
  618                 
  619  212C                           %CLR_AUX
    /                                 
    /  212C CE43A0                    ldx             #arry_aux
    /  212F 8608                      ldaa            #N_AUX*SA_SIZE
    /  2131 C600                      ldab            #0
    /  2133 BD29CC                    jsr             clrarray
    /                 
  620                 
  621                 * termine de entrar los barcos?
  622  2136 18A603    sa_check        ldaa            SA_CONT,Y
  623  2139 18A104                    cmpa            SA_TOT,Y
  624  213C 2603                      bne             sa_show
  625  213E                           %GOTO           sa_end  
    /                 
    /  213E 7E242D                    jmp     sa_end
    /                 
  626                 
  627                 * display mensaje para indicar barco
  628  2141 18A10F    sa_show         cmpa            SA_CSUB,Y
  629  2144 240C                      bhs             show_shi
  630  2146 CE43A8    show_sub        ldx             #msg_sub
  631  2149 8605                      ldaa            #5
  632  214B 18E603                    ldab            SA_CONT,Y
  633  214E 3D                        mul
  634  214F 3A                        abx
  635  2150 200F                      bra             show_jmp
  636  2152 CE43C1    show_shi        ldx             #msg_shi
  637  2155 18A603                    ldaa            SA_CONT,Y
  638  2158 18E60F                    ldab            SA_CSUB,Y
  639  215B 10                        sba
  640  215C 16                        tab
  641  215D 8605                      ldaa            #5
  642  215F 3D                        mul
  643  2160 3A                        abx
  644  2161 BD28EE    show_jmp        jsr             show
  645  2164                           %EXPECT         B_reset
    /                                 
    /  2164 BD2902    expe0000          jsr             read_kb
    /  2167 4D                        tsta
    /  2168 2BFA                      bmi             expe0000
    /  216A 810F                      cmpa            #B_reset
    /  216C 26F6                      bne             expe0000
    /                 
  646                 
  647                 * espera ingreso de coordenada
  648  216E BD284E    sa_again        jsr             input
  649                 
  650  2171 18A700                    staa            SA_FIL,Y
  651  2174 18E701                    stab            SA_COL,Y
  652                 
  653                 * verifico que no sea una posicion prohibida
  654  2177                           %IS_PROH
    /                 
    /  2177 36                        psha
    /  2178 37                        pshb
    /  2179 CE42D8                    ldx             #arry_pr
    /  217C 3C                        pshx
    /  217D 4F                        clra
    /  217E 36                        psha
    /  217F BD27A0                    jsr             play_src
    /  2182 32                        pula
    /  2183 38                        pulx
    /  2184 33                        pulb
    /  2185 32                        pula
    /                 
  655  2186 25E6                      bcs             sa_again
  656                 
  657                 * me fijo que tipo de barco se ingresa
  658  2188 36                        psha
  659  2189 18A603                    ldaa            SA_CONT,Y
  660  218C 18A10F                    cmpa            SA_CSUB,Y
  661  218F 32                        pula
  662  2190 2503                      blo             sa_sub
  663  2192                           %GOTO           sa_shi
    /                 
    /  2192 7E2253                    jmp     sa_shi
    /                 
  664                 
  665                 * escribo en matriz el submarino
  666  2195           sa_sub          %PROH_POS
    /                                 
    /  2195 4D                        tsta
    /  2196 2602                      bne             oka0001
    /  2198 86FF                      ldaa            #$FF
    /  219A 5D        oka0001           tstb
    /  219B 2602                      bne             okb0002
    /  219D C6FF                      ldab            #$FF
    /  219F 36        okb0002           psha
    /  21A0 37                        pshb
    /  21A1 CE42D8                    ldx             #arry_pr
    /  21A4 3C                        pshx
    /  21A5 4F                        clra
    /  21A6 36                        psha
    /  21A7 BD27F7                    jsr             play_wrt
    /  21AA 32                        pula
    /  21AB 38                        pulx
    /  21AC 33                        pulb
    /  21AD 32                        pula
    /                 
  667  21AE                           %PROH_PER
    /                                         
    /  21AE 4C                        inca
    /  21AF                           %PROH_POS
    /                                 
    /  21AF 4D                        tsta
    /  21B0 2602                      bne             oka0003
    /  21B2 86FF                      ldaa            #$FF
    /  21B4 5D        oka0003           tstb
    /  21B5 2602                      bne             okb0004
    /  21B7 C6FF                      ldab            #$FF
    /  21B9 36        okb0004           psha
    /  21BA 37                        pshb
    /  21BB CE42D8                    ldx             #arry_pr
    /  21BE 3C                        pshx
    /  21BF 4F                        clra
    /  21C0 36                        psha
    /  21C1 BD27F7                    jsr             play_wrt
    /  21C4 32                        pula
    /  21C5 38                        pulx
    /  21C6 33                        pulb
    /  21C7 32                        pula
    /                 
    /                         
    /  21C8 4A                        deca
    /  21C9 5C                        incb
    /  21CA                           %PROH_POS
    /                                 
    /  21CA 4D                        tsta
    /  21CB 2602                      bne             oka0005
    /  21CD 86FF                      ldaa            #$FF
    /  21CF 5D        oka0005           tstb
    /  21D0 2602                      bne             okb0006
    /  21D2 C6FF                      ldab            #$FF
    /  21D4 36        okb0006           psha
    /  21D5 37                        pshb
    /  21D6 CE42D8                    ldx             #arry_pr
    /  21D9 3C                        pshx
    /  21DA 4F                        clra
    /  21DB 36                        psha
    /  21DC BD27F7                    jsr             play_wrt
    /  21DF 32                        pula
    /  21E0 38                        pulx
    /  21E1 33                        pulb
    /  21E2 32                        pula
    /                 
    /                 
    /  21E3 4A                        deca
    /  21E4 5A                        decb
    /  21E5                           %PROH_POS
    /                                 
    /  21E5 4D                        tsta
    /  21E6 2602                      bne             oka0007
    /  21E8 86FF                      ldaa            #$FF
    /  21EA 5D        oka0007           tstb
    /  21EB 2602                      bne             okb0008
    /  21ED C6FF                      ldab            #$FF
    /  21EF 36        okb0008           psha
    /  21F0 37                        pshb
    /  21F1 CE42D8                    ldx             #arry_pr
    /  21F4 3C                        pshx
    /  21F5 4F                        clra
    /  21F6 36                        psha
    /  21F7 BD27F7                    jsr             play_wrt
    /  21FA 32                        pula
    /  21FB 38                        pulx
    /  21FC 33                        pulb
    /  21FD 32                        pula
    /                 
    /                 
    /  21FE 4C                        inca
    /  21FF 5A                        decb
    /  2200                           %PROH_POS
    /                                 
    /  2200 4D                        tsta
    /  2201 2602                      bne             oka0009
    /  2203 86FF                      ldaa            #$FF
    /  2205 5D        oka0009           tstb
    /  2206 2602                      bne             okb0010
    /  2208 C6FF                      ldab            #$FF
    /  220A 36        okb0010           psha
    /  220B 37                        pshb
    /  220C CE42D8                    ldx             #arry_pr
    /  220F 3C                        pshx
    /  2210 4F                        clra
    /  2211 36                        psha
    /  2212 BD27F7                    jsr             play_wrt
    /  2215 32                        pula
    /  2216 38                        pulx
    /  2217 33                        pulb
    /  2218 32                        pula
    /                 
    /                 
  668  2219                           %SET_POS        BY_SUB
    /                 
    /  2219 8640                      ldaa            #BY_SUB
    /  221B 36                        psha
    /  221C 18A600                    ldaa            SA_FIL,Y
    /  221F 36                        psha
    /  2220 18E601                    ldab            SA_COL,Y
    /  2223 37                        pshb
    /  2224 CDEE0D                    ldx             SA_MAT,Y
    /  2227 3C                        pshx
    /  2228 4F                        clra
    /  2229 36                        psha
    /  222A BD276F                    jsr             writepos
    /  222D 32                        pula
    /  222E 38                        pulx
    /  222F 33                        pulb
    /  2230 32                        pula
    /  2231 32                        pula
    /                 
  669  2232 186C03                    inc             SA_CONT,Y
  670  2235                           %REFRESH
    /                 
    /  2235 183C                      pshy
    /  2237 CDEE0D                    ldx             SA_MAT,Y
    /  223A 3C                        pshx
    /  223B 4F                        clra
    /  223C 36                        psha
    /  223D 18CE5F00                  ldy             #display
    /  2241 183C                      pshy
    /  2243 8624                      ldaa            #ARRAY_L
    /  2245 36                        psha
    /  2246 BD2715                    jsr             mirror
    /  2249 32                        pula
    /  224A 1838                      puly
    /  224C 32                        pula
    /  224D 38                        pulx
    /  224E 1838                      puly    
    /                 
  671  2250                           %GOTO           sa_check
    /                 
    /  2250 7E2136                    jmp     sa_check
    /                 
  672                 
  673  2253 186D02    sa_shi          tst             SA_CARG,Y
  674  2256 2703                      beq             sa_part1
  675  2258                           %GOTO           sa_part2
    /                 
    /  2258 7E230D                    jmp     sa_part2
    /                 
  676                 
  677  225B           sa_part1        %SET_AUX
    /                                 
    /  225B 4C                        inca
    /  225C                           %AUX_POS
    /                 
    /  225C 36                        psha
    /  225D 37                        pshb
    /  225E CE43A0                    ldx             #arry_aux
    /  2261 3C                        pshx
    /  2262 4F                        clra
    /  2263 36                        psha
    /  2264 BD27F7                    jsr             play_wrt
    /  2267 32                        pula
    /  2268 38                        pulx
    /  2269 33                        pulb
    /  226A 32                        pula
    /                 
    /                                 
    /  226B 4A                        deca
    /  226C 5C                        incb
    /  226D                           %AUX_POS
    /                 
    /  226D 36                        psha
    /  226E 37                        pshb
    /  226F CE43A0                    ldx             #arry_aux
    /  2272 3C                        pshx
    /  2273 4F                        clra
    /  2274 36                        psha
    /  2275 BD27F7                    jsr             play_wrt
    /  2278 32                        pula
    /  2279 38                        pulx
    /  227A 33                        pulb
    /  227B 32                        pula
    /                 
    /                                 
    /  227C 4A                        deca
    /  227D 5A                        decb
    /  227E                           %AUX_POS
    /                 
    /  227E 36                        psha
    /  227F 37                        pshb
    /  2280 CE43A0                    ldx             #arry_aux
    /  2283 3C                        pshx
    /  2284 4F                        clra
    /  2285 36                        psha
    /  2286 BD27F7                    jsr             play_wrt
    /  2289 32                        pula
    /  228A 38                        pulx
    /  228B 33                        pulb
    /  228C 32                        pula
    /                 
    /                 
    /  228D 4C                        inca
    /  228E 5A                        decb
    /  228F                           %AUX_POS                
    /                 
    /  228F 36                        psha
    /  2290 37                        pshb
    /  2291 CE43A0                    ldx             #arry_aux
    /  2294 3C                        pshx
    /  2295 4F                        clra
    /  2296 36                        psha
    /  2297 BD27F7                    jsr             play_wrt
    /  229A 32                        pula
    /  229B 38                        pulx
    /  229C 33                        pulb
    /  229D 32                        pula
    /                 
    /                 
  678                                 
  679  229E 183C                      pshy
  680  22A0 18CE43A0                  ldy             #arry_aux
  681  22A4 C604                      ldab            #N_AUX
  682  22A6 5A        sa_loop         decb
  683  22A7 2B1F                      bmi             sa_notok
  684  22A9 37                        pshb
  685  22AA 18A600                    ldaa            0,Y
  686  22AD 18E601                    ldab            1,Y
  687  22B0                           %IS_PROH
    /                 
    /  22B0 36                        psha
    /  22B1 37                        pshb
    /  22B2 CE42D8                    ldx             #arry_pr
    /  22B5 3C                        pshx
    /  22B6 4F                        clra
    /  22B7 36                        psha
    /  22B8 BD27A0                    jsr             play_src
    /  22BB 32                        pula
    /  22BC 38                        pulx
    /  22BD 33                        pulb
    /  22BE 32                        pula
    /                 
  688  22BF 33                        pulb
  689  22C0 240B                      bcc             sa_ok
  690  22C2 1808                      iny
  691  22C4 1808                      iny
  692  22C6 20DE                      bra             sa_loop
  693                 
  694  22C8 1838      sa_notok        puly
  695  22CA                           %GOTO           sa_again
    /                 
    /  22CA 7E216E                    jmp     sa_again
    /                 
  696                 
  697  22CD 1838      sa_ok           puly
  698  22CF 18A600                    ldaa            SA_FIL,Y
  699  22D2 18E601                    ldab            SA_COL,Y
  700  22D5                           %PROH_POS
    /                                 
    /  22D5 4D                        tsta
    /  22D6 2602                      bne             oka0011
    /  22D8 86FF                      ldaa            #$FF
    /  22DA 5D        oka0011           tstb
    /  22DB 2602                      bne             okb0012
    /  22DD C6FF                      ldab            #$FF
    /  22DF 36        okb0012           psha
    /  22E0 37                        pshb
    /  22E1 CE42D8                    ldx             #arry_pr
    /  22E4 3C                        pshx
    /  22E5 4F                        clra
    /  22E6 36                        psha
    /  22E7 BD27F7                    jsr             play_wrt
    /  22EA 32                        pula
    /  22EB 38                        pulx
    /  22EC 33                        pulb
    /  22ED 32                        pula
    /                 
  701  22EE 186C02                    inc             SA_CARG,Y
  702  22F1                           %SET_POS        BY_SHI
    /                 
    /  22F1 8680                      ldaa            #BY_SHI
    /  22F3 36                        psha
    /  22F4 18A600                    ldaa            SA_FIL,Y
    /  22F7 36                        psha
    /  22F8 18E601                    ldab            SA_COL,Y
    /  22FB 37                        pshb
    /  22FC CDEE0D                    ldx             SA_MAT,Y
    /  22FF 3C                        pshx
    /  2300 4F                        clra
    /  2301 36                        psha
    /  2302 BD276F                    jsr             writepos
    /  2305 32                        pula
    /  2306 38                        pulx
    /  2307 33                        pulb
    /  2308 32                        pula
    /  2309 32                        pula
    /                 
  703  230A                           %GOTO           sa_again
    /                 
    /  230A 7E216E                    jmp     sa_again
    /                 
  704  230D CE43A0    sa_part2        ldx             #arry_aux
  705  2310 8604                      ldaa            #N_AUX
  706  2312 4A        sa_verf         deca
  707  2313 2A03                      bpl             sa_chk          
  708  2315                           %GOTO           sa_again
    /                 
    /  2315 7E216E                    jmp     sa_again
    /                 
  709  2318 E600      sa_chk          ldab            0,X
  710  231A 18E100                    cmpb            SA_FIL,Y
  711  231D 2609                      bne             sa_not
  712  231F E601                      ldab            1,X
  713  2321 18E101                    cmpb            SA_COL,Y
  714  2324 2602                      bne             sa_not
  715  2326 2004                      bra             sa_good
  716  2328 08        sa_not          inx
  717  2329 08                        inx
  718  232A 20E6                      bra             sa_verf
  719                 
  720  232C 183C      sa_good         pshy
  721  232E 18CE43A0                  ldy             #arry_aux
  722  2332 C604                      ldab            #4
  723  2334 5A        sa_loop2        decb
  724  2335 2B23                      bmi             sa_done
  725  2337 37                        pshb
  726  2338 18A600                    ldaa            0,Y
  727  233B 18E601                    ldab            1,Y
  728  233E                           %PROH_POS
    /                                 
    /  233E 4D                        tsta
    /  233F 2602                      bne             oka0013
    /  2341 86FF                      ldaa            #$FF
    /  2343 5D        oka0013           tstb
    /  2344 2602                      bne             okb0014
    /  2346 C6FF                      ldab            #$FF
    /  2348 36        okb0014           psha
    /  2349 37                        pshb
    /  234A CE42D8                    ldx             #arry_pr
    /  234D 3C                        pshx
    /  234E 4F                        clra
    /  234F 36                        psha
    /  2350 BD27F7                    jsr             play_wrt
    /  2353 32                        pula
    /  2354 38                        pulx
    /  2355 33                        pulb
    /  2356 32                        pula
    /                 
  729  2357 33                        pulb
  730  2358 20DA                      bra             sa_loop2
  731                 
  732  235A 1838      sa_done         puly
  733  235C 18A600                    ldaa            SA_FIL,Y
  734  235F 18E601                    ldab            SA_COL,Y
  735  2362                           %PROH_POS
    /                                 
    /  2362 4D                        tsta
    /  2363 2602                      bne             oka0015
    /  2365 86FF                      ldaa            #$FF
    /  2367 5D        oka0015           tstb
    /  2368 2602                      bne             okb0016
    /  236A C6FF                      ldab            #$FF
    /  236C 36        okb0016           psha
    /  236D 37                        pshb
    /  236E CE42D8                    ldx             #arry_pr
    /  2371 3C                        pshx
    /  2372 4F                        clra
    /  2373 36                        psha
    /  2374 BD27F7                    jsr             play_wrt
    /  2377 32                        pula
    /  2378 38                        pulx
    /  2379 33                        pulb
    /  237A 32                        pula
    /                 
  736  237B                           %PROH_PER
    /                                         
    /  237B 4C                        inca
    /  237C                           %PROH_POS
    /                                 
    /  237C 4D                        tsta
    /  237D 2602                      bne             oka0017
    /  237F 86FF                      ldaa            #$FF
    /  2381 5D        oka0017           tstb
    /  2382 2602                      bne             okb0018
    /  2384 C6FF                      ldab            #$FF
    /  2386 36        okb0018           psha
    /  2387 37                        pshb
    /  2388 CE42D8                    ldx             #arry_pr
    /  238B 3C                        pshx
    /  238C 4F                        clra
    /  238D 36                        psha
    /  238E BD27F7                    jsr             play_wrt
    /  2391 32                        pula
    /  2392 38                        pulx
    /  2393 33                        pulb
    /  2394 32                        pula
    /                 
    /                         
    /  2395 4A                        deca
    /  2396 5C                        incb
    /  2397                           %PROH_POS
    /                                 
    /  2397 4D                        tsta
    /  2398 2602                      bne             oka0019
    /  239A 86FF                      ldaa            #$FF
    /  239C 5D        oka0019           tstb
    /  239D 2602                      bne             okb0020
    /  239F C6FF                      ldab            #$FF
    /  23A1 36        okb0020           psha
    /  23A2 37                        pshb
    /  23A3 CE42D8                    ldx             #arry_pr
    /  23A6 3C                        pshx
    /  23A7 4F                        clra
    /  23A8 36                        psha
    /  23A9 BD27F7                    jsr             play_wrt
    /  23AC 32                        pula
    /  23AD 38                        pulx
    /  23AE 33                        pulb
    /  23AF 32                        pula
    /                 
    /                 
    /  23B0 4A                        deca
    /  23B1 5A                        decb
    /  23B2                           %PROH_POS
    /                                 
    /  23B2 4D                        tsta
    /  23B3 2602                      bne             oka0021
    /  23B5 86FF                      ldaa            #$FF
    /  23B7 5D        oka0021           tstb
    /  23B8 2602                      bne             okb0022
    /  23BA C6FF                      ldab            #$FF
    /  23BC 36        okb0022           psha
    /  23BD 37                        pshb
    /  23BE CE42D8                    ldx             #arry_pr
    /  23C1 3C                        pshx
    /  23C2 4F                        clra
    /  23C3 36                        psha
    /  23C4 BD27F7                    jsr             play_wrt
    /  23C7 32                        pula
    /  23C8 38                        pulx
    /  23C9 33                        pulb
    /  23CA 32                        pula
    /                 
    /                 
    /  23CB 4C                        inca
    /  23CC 5A                        decb
    /  23CD                           %PROH_POS
    /                                 
    /  23CD 4D                        tsta
    /  23CE 2602                      bne             oka0023
    /  23D0 86FF                      ldaa            #$FF
    /  23D2 5D        oka0023           tstb
    /  23D3 2602                      bne             okb0024
    /  23D5 C6FF                      ldab            #$FF
    /  23D7 36        okb0024           psha
    /  23D8 37                        pshb
    /  23D9 CE42D8                    ldx             #arry_pr
    /  23DC 3C                        pshx
    /  23DD 4F                        clra
    /  23DE 36                        psha
    /  23DF BD27F7                    jsr             play_wrt
    /  23E2 32                        pula
    /  23E3 38                        pulx
    /  23E4 33                        pulb
    /  23E5 32                        pula
    /                 
    /                 
  737  23E6                           %SET_POS        BY_SHI
    /                 
    /  23E6 8680                      ldaa            #BY_SHI
    /  23E8 36                        psha
    /  23E9 18A600                    ldaa            SA_FIL,Y
    /  23EC 36                        psha
    /  23ED 18E601                    ldab            SA_COL,Y
    /  23F0 37                        pshb
    /  23F1 CDEE0D                    ldx             SA_MAT,Y
    /  23F4 3C                        pshx
    /  23F5 4F                        clra
    /  23F6 36                        psha
    /  23F7 BD276F                    jsr             writepos
    /  23FA 32                        pula
    /  23FB 38                        pulx
    /  23FC 33                        pulb
    /  23FD 32                        pula
    /  23FE 32                        pula
    /                 
  738  23FF 186C03                    inc             SA_CONT,Y
  739  2402 186F02                    clr             SA_CARG,Y
  740  2405                           %CLR_AUX
    /                                 
    /  2405 CE43A0                    ldx             #arry_aux
    /  2408 8608                      ldaa            #N_AUX*SA_SIZE
    /  240A C600                      ldab            #0
    /  240C BD29CC                    jsr             clrarray
    /                 
  741  240F                           %REFRESH
    /                 
    /  240F 183C                      pshy
    /  2411 CDEE0D                    ldx             SA_MAT,Y
    /  2414 3C                        pshx
    /  2415 4F                        clra
    /  2416 36                        psha
    /  2417 18CE5F00                  ldy             #display
    /  241B 183C                      pshy
    /  241D 8624                      ldaa            #ARRAY_L
    /  241F 36                        psha
    /  2420 BD2715                    jsr             mirror
    /  2423 32                        pula
    /  2424 1838                      puly
    /  2426 32                        pula
    /  2427 38                        pulx
    /  2428 1838                      puly    
    /                 
  742  242A                           %GOTO           sa_check
    /                 
    /  242A 7E2136                    jmp     sa_check
    /                 
  743                 
  744                 * libero variables temporales
  745  242D           sa_end          %FIX_ARRY
    /                 
    /  242D CDEE0D                    ldx             SA_MAT,Y
    /  2430 8624                      ldaa            #ARRAY_L
    /  2432 E600      loop0025          ldab            0,X
    /  2434 C4C0                      andb            #11000000b
    /  2436 CA03                      orab            #00000011b
    /  2438 E700                      stab            0,X
    /  243A 08                        inx
    /  243B 4A                        deca
    /  243C 26F4                      bne             loop0025
    /                 
  746  243E                           %CLS
    /                                 
    /  243E CE5F00                    ldx             #display
    /  2441 8624                      ldaa            #ARRAY_L
    /  2443 C603                      ldab            #$03
    /  2445 E700      cls0026           stab            0,X
    /  2447 08                        inx
    /  2448 4A                        deca
    /  2449 26FA                      bne             cls0026
    /                 
  747  244B 32                        pula
  748  244C 32                        pula
  749  244D 32                        pula
  750  244E 32                        pula
  751  244F 32                        pula
  752                 
  753                 * restore de registros
  754  2450 1838                      puly
  755  2452 38                        pulx
  756  2453 33                        pulb
  757  2454 32                        pula
  758                 
  759  2455 39                        rts
  760                 
  761                 *=======================================================================
  762                 * subrutina gameplay
  763                 * Función: Determina si la posición jugada en el juego de batalla naval
  764                 *          para Wookie FX fue "agua", "submarion" o "carguero", y toma 
  765                 *          la decisión de qué hacer al respecto.
  766                 * Recibe: - Dirección arreglo auxiliar de barcos
  767                 *         - Byte a jugar.
  768                 *         - FILA del array (En HEX, de $0A (fil.0) en adelante)
  769                 *         - COLUMNA del array (en HEX)
  770                 *         - Dirección de comienzo del arreglo (2 bytes)
  771                 *         - Número de arreglo (de 0 en adelante) (número de jugador)
  772                 *       TODO POR STACK.
  773                 * Devuelve: parámetro jugado en posición correspondiente.
  774                 * Requiere: 
  775                 *=======================================================================
  776  2456           gameplay        EQU             *
  777  2456                           %BACKUP
    /  2456 36                        psha
    /  2457 37                        pshb
    /  2458 3C                        pshx
    /  2459 183C                      pshy
  778                                 
  779  245B 30                        tsx                             ;se usa el IX como frame pointer
  780  245C A60D                      ldaa            13,x            ;se carga en AccA el byte a analizar
  781  245E 84C0                      anda            #11000000b      ;se enmascan los bits 0 a 5, para analizar los más significativos
  782                 
  783  2460           gp_water        EQU             *
  784  2460 2620                      bne             gp_sub          ;se estudia si era agua
  785  2462                           %WRITEPOS       #WATER          ;se cambia el color en el tablero
    /  2462 C608                      ldab            #WATER
    /  2464 37                        pshb                            ;se envía el byte a escribir
    /  2465 E60C                      ldab            12,x
    /  2467 37                        pshb                            ;se envía letra (fila)
    /  2468 E60B                      ldab            11,x
    /  246A 37                        pshb                            ;se envía num (columna)
    /  246B 1AEE09                    ldy             9,x
    /  246E 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  2470 E608                      ldab            8,x
    /  2472 37                        pshb                            ;se envía jugador atacado
    /  2473 BD276F                    jsr             writepos
    /  2476                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  2476                           IF CONT_M > 0
    /  2476 31                        ins
    /  2477                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  2477                           IF CONT_M > 0
    /  2477 31                        ins
    /  2478                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2478                           IF CONT_M > 0
    /  2478 31                        ins
    /  2479                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2479                           IF CONT_M > 0
    /  2479 31                        ins
    /  247A                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  247A                           IF CONT_M > 0
    /  247A 31                        ins
    /  247B                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  247B                           IF CONT_M > 0
    /  247B 31                        ins
    /  247C                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  247C                           ENDIF
    /  247C                           ENDIF
    /  247C                           ENDIF
    /  247C                           ENDIF
    /  247C                           ENDIF
    /  247C                           ENDIF
    /  247C                           ENDIF
  786  247C                           %RESTORE
    /  247C 1838                      puly
    /  247E 38                        pulx
    /  247F 33                        pulb
    /  2480 32                        pula
  787  2481 39                        rts
  788                 
  789  2482           gp_sub          EQU             *
  790  2482 8140                      cmpa            #01000000b      ;se estudia si era un submarino
  791  2484 2636                      bne             gp_shi_r
  792  2486                           %WRITEPOS       #SUNK_SUB       ;se cambia el color en el tablero
    /  2486 C650                      ldab            #SUNK_SUB
    /  2488 37                        pshb                            ;se envía el byte a escribir
    /  2489 E60C                      ldab            12,x
    /  248B 37                        pshb                            ;se envía letra (fila)
    /  248C E60B                      ldab            11,x
    /  248E 37                        pshb                            ;se envía num (columna)
    /  248F 1AEE09                    ldy             9,x
    /  2492 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  2494 E608                      ldab            8,x
    /  2496 37                        pshb                            ;se envía jugador atacado
    /  2497 BD276F                    jsr             writepos
    /  249A                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  249A                           IF CONT_M > 0
    /  249A 31                        ins
    /  249B                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  249B                           IF CONT_M > 0
    /  249B 31                        ins
    /  249C                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  249C                           IF CONT_M > 0
    /  249C 31                        ins
    /  249D                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  249D                           IF CONT_M > 0
    /  249D 31                        ins
    /  249E                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  249E                           IF CONT_M > 0
    /  249E 31                        ins
    /  249F                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  249F                           IF CONT_M > 0
    /  249F 31                        ins
    /  24A0                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  24A0                           ENDIF
    /  24A0                           ENDIF
    /  24A0                           ENDIF
    /  24A0                           ENDIF
    /  24A0                           ENDIF
    /  24A0                           ENDIF
    /  24A0                           ENDIF
  793  24A0                           %PLAY_WRT                       ;se agraga la posición al array de barcos atacados
    /  24A0 E60C                      ldab            12,x
    /  24A2 37                        pshb                            ;se envía letra (fila)
    /  24A3 E60B                      ldab            11,x
    /  24A5 37                        pshb                            ;se envía num (columna)
    /  24A6 1AEE0E                    ldy             14,x
    /  24A9 183C                      pshy                            ;se envía inicio de array
    /  24AB E608                      ldab            8,x
    /  24AD 37                        pshb                            ;se envía jugador atacado
    /  24AE BD27F7                    jsr             play_wrt
    /  24B1                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  24B1                           IF CONT_M > 0
    /  24B1 31                        ins
    /  24B2                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  24B2                           IF CONT_M > 0
    /  24B2 31                        ins
    /  24B3                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  24B3                           IF CONT_M > 0
    /  24B3 31                        ins
    /  24B4                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  24B4                           IF CONT_M > 0
    /  24B4 31                        ins
    /  24B5                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  24B5                           IF CONT_M > 0
    /  24B5 31                        ins
    /  24B6                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  24B6                           ENDIF
    /  24B6                           ENDIF
    /  24B6                           ENDIF
    /  24B6                           ENDIF
    /  24B6                           ENDIF
    /  24B6                           ENDIF
  794  24B6                           %RESTORE
    /  24B6 1838                      puly
    /  24B8 38                        pulx
    /  24B9 33                        pulb
    /  24BA 32                        pula
  795  24BB 39                        rts
  796                 
  797  24BC           gp_shi_r        EQU             *               ;si no era ninguno de los anteriores, es un carguero
  798  24BC E60B                      ldab            11,x
  799  24BE C106                      cmpb            #MAX_C
  800  24C0 276D                      beq             gp_shi_l        ;si está en el borde derecho, se continúa
  801  24C2 E60C                      ldab            12,x
  802  24C4 37                        pshb                            ;se envía la letra (fila)
  803  24C5 E60B                      ldab            11,x
  804  24C7 5C                        incb                            ;se avanza a la derecha
  805  24C8 37                        pshb                            ;se envía el num (columna)
  806  24C9 1AEE0E                    ldy             14,x
  807  24CC 183C                      pshy                            ;se envía el inicio del arreglo de barcos atacados
  808  24CE E608                      ldab            8,x
  809  24D0 37                        pshb                            ;se envía el jugador atacado
  810  24D1 BD27A0                    jsr             play_src        ;se busca la posición de la derecha
  811  24D4                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  24D4                           IF CONT_M > 0
    /  24D4 31                        ins
    /  24D5                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  24D5                           IF CONT_M > 0
    /  24D5 31                        ins
    /  24D6                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  24D6                           IF CONT_M > 0
    /  24D6 31                        ins
    /  24D7                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  24D7                           IF CONT_M > 0
    /  24D7 31                        ins
    /  24D8                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  24D8                           IF CONT_M > 0
    /  24D8 31                        ins
    /  24D9                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  24D9                           ENDIF
    /  24D9                           ENDIF
    /  24D9                           ENDIF
    /  24D9                           ENDIF
    /  24D9                           ENDIF
    /  24D9                           ENDIF
  812  24D9 2454                      bcc             gp_shi_l        ;si no había barco atacado en la derecha, se busca la izquierda
  813  24DB                           %WRITEPOS       #SUNK_SHI       
    /  24DB C690                      ldab            #SUNK_SHI
    /  24DD 37                        pshb                            ;se envía el byte a escribir
    /  24DE E60C                      ldab            12,x
    /  24E0 37                        pshb                            ;se envía letra (fila)
    /  24E1 E60B                      ldab            11,x
    /  24E3 37                        pshb                            ;se envía num (columna)
    /  24E4 1AEE09                    ldy             9,x
    /  24E7 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  24E9 E608                      ldab            8,x
    /  24EB 37                        pshb                            ;se envía jugador atacado
    /  24EC BD276F                    jsr             writepos
    /  24EF                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  24EF                           IF CONT_M > 0
    /  24EF 31                        ins
    /  24F0                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  24F0                           IF CONT_M > 0
    /  24F0 31                        ins
    /  24F1                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  24F1                           IF CONT_M > 0
    /  24F1 31                        ins
    /  24F2                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  24F2                           IF CONT_M > 0
    /  24F2 31                        ins
    /  24F3                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  24F3                           IF CONT_M > 0
    /  24F3 31                        ins
    /  24F4                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  24F4                           IF CONT_M > 0
    /  24F4 31                        ins
    /  24F5                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  24F5                           ENDIF
    /  24F5                           ENDIF
    /  24F5                           ENDIF
    /  24F5                           ENDIF
    /  24F5                           ENDIF
    /  24F5                           ENDIF
    /  24F5                           ENDIF
  814  24F5 6C0B                      inc             11,x
  815  24F7                           %WRITEPOS       #SUNK_SHI       ;se "hunde" a TODO el carguero
    /  24F7 C690                      ldab            #SUNK_SHI
    /  24F9 37                        pshb                            ;se envía el byte a escribir
    /  24FA E60C                      ldab            12,x
    /  24FC 37                        pshb                            ;se envía letra (fila)
    /  24FD E60B                      ldab            11,x
    /  24FF 37                        pshb                            ;se envía num (columna)
    /  2500 1AEE09                    ldy             9,x
    /  2503 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  2505 E608                      ldab            8,x
    /  2507 37                        pshb                            ;se envía jugador atacado
    /  2508 BD276F                    jsr             writepos
    /  250B                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  250B                           IF CONT_M > 0
    /  250B 31                        ins
    /  250C                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  250C                           IF CONT_M > 0
    /  250C 31                        ins
    /  250D                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  250D                           IF CONT_M > 0
    /  250D 31                        ins
    /  250E                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  250E                           IF CONT_M > 0
    /  250E 31                        ins
    /  250F                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  250F                           IF CONT_M > 0
    /  250F 31                        ins
    /  2510                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2510                           IF CONT_M > 0
    /  2510 31                        ins
    /  2511                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2511                           ENDIF
    /  2511                           ENDIF
    /  2511                           ENDIF
    /  2511                           ENDIF
    /  2511                           ENDIF
    /  2511                           ENDIF
    /  2511                           ENDIF
  816  2511 6A0B                      dec             11,x            ;se recupera el dato
  817  2513                           %PLAY_WRT                       ;se agrega la posición al array de barcos atacados
    /  2513 E60C                      ldab            12,x
    /  2515 37                        pshb                            ;se envía letra (fila)
    /  2516 E60B                      ldab            11,x
    /  2518 37                        pshb                            ;se envía num (columna)
    /  2519 1AEE0E                    ldy             14,x
    /  251C 183C                      pshy                            ;se envía inicio de array
    /  251E E608                      ldab            8,x
    /  2520 37                        pshb                            ;se envía jugador atacado
    /  2521 BD27F7                    jsr             play_wrt
    /  2524                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  2524                           IF CONT_M > 0
    /  2524 31                        ins
    /  2525                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2525                           IF CONT_M > 0
    /  2525 31                        ins
    /  2526                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2526                           IF CONT_M > 0
    /  2526 31                        ins
    /  2527                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2527                           IF CONT_M > 0
    /  2527 31                        ins
    /  2528                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2528                           IF CONT_M > 0
    /  2528 31                        ins
    /  2529                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2529                           ENDIF
    /  2529                           ENDIF
    /  2529                           ENDIF
    /  2529                           ENDIF
    /  2529                           ENDIF
    /  2529                           ENDIF
  818  2529                           %RESTORE
    /  2529 1838                      puly
    /  252B 38                        pulx
    /  252C 33                        pulb
    /  252D 32                        pula
  819  252E 39                        rts
  820                 
  821  252F           gp_shi_l        EQU             *
  822  252F E60B                      ldab            11,x
  823  2531 C101                      cmpb            #MIN_C
  824  2533 276D                      beq             gp_shi_u        ;si está en el borde izquierdo, se continúa
  825  2535 E60C                      ldab            12,x
  826  2537 37                        pshb                            ;se envía la letra (fila)
  827  2538 E60B                      ldab            11,x
  828  253A 5A                        decb                            ;se retrocede a la izquierda
  829  253B 37                        pshb                            ;se envía el número (columna)
  830  253C 1AEE0E                    ldy             14,x
  831  253F 183C                      pshy                            ;se envía el inicio del arreglo de barcos atacados
  832  2541 E608                      ldab            8,x
  833  2543 37                        pshb                            ;se envía el jugador atacado
  834  2544 BD27A0                    jsr             play_src        ;se busca la posición de la izquierda
  835  2547                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  2547                           IF CONT_M > 0
    /  2547 31                        ins
    /  2548                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2548                           IF CONT_M > 0
    /  2548 31                        ins
    /  2549                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2549                           IF CONT_M > 0
    /  2549 31                        ins
    /  254A                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  254A                           IF CONT_M > 0
    /  254A 31                        ins
    /  254B                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  254B                           IF CONT_M > 0
    /  254B 31                        ins
    /  254C                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  254C                           ENDIF
    /  254C                           ENDIF
    /  254C                           ENDIF
    /  254C                           ENDIF
    /  254C                           ENDIF
    /  254C                           ENDIF
  836  254C 2454                      bcc             gp_shi_u        ;si no había barco atacado a la izquierda, se busca arriba
  837  254E                           %WRITEPOS       #SUNK_SHI       
    /  254E C690                      ldab            #SUNK_SHI
    /  2550 37                        pshb                            ;se envía el byte a escribir
    /  2551 E60C                      ldab            12,x
    /  2553 37                        pshb                            ;se envía letra (fila)
    /  2554 E60B                      ldab            11,x
    /  2556 37                        pshb                            ;se envía num (columna)
    /  2557 1AEE09                    ldy             9,x
    /  255A 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  255C E608                      ldab            8,x
    /  255E 37                        pshb                            ;se envía jugador atacado
    /  255F BD276F                    jsr             writepos
    /  2562                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  2562                           IF CONT_M > 0
    /  2562 31                        ins
    /  2563                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  2563                           IF CONT_M > 0
    /  2563 31                        ins
    /  2564                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2564                           IF CONT_M > 0
    /  2564 31                        ins
    /  2565                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2565                           IF CONT_M > 0
    /  2565 31                        ins
    /  2566                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2566                           IF CONT_M > 0
    /  2566 31                        ins
    /  2567                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2567                           IF CONT_M > 0
    /  2567 31                        ins
    /  2568                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2568                           ENDIF
    /  2568                           ENDIF
    /  2568                           ENDIF
    /  2568                           ENDIF
    /  2568                           ENDIF
    /  2568                           ENDIF
    /  2568                           ENDIF
  838  2568 6A0B                      dec             11,x
  839  256A                           %WRITEPOS       #SUNK_SHI       ;se "hunde" a TODO el carguero
    /  256A C690                      ldab            #SUNK_SHI
    /  256C 37                        pshb                            ;se envía el byte a escribir
    /  256D E60C                      ldab            12,x
    /  256F 37                        pshb                            ;se envía letra (fila)
    /  2570 E60B                      ldab            11,x
    /  2572 37                        pshb                            ;se envía num (columna)
    /  2573 1AEE09                    ldy             9,x
    /  2576 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  2578 E608                      ldab            8,x
    /  257A 37                        pshb                            ;se envía jugador atacado
    /  257B BD276F                    jsr             writepos
    /  257E                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  257E                           IF CONT_M > 0
    /  257E 31                        ins
    /  257F                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  257F                           IF CONT_M > 0
    /  257F 31                        ins
    /  2580                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2580                           IF CONT_M > 0
    /  2580 31                        ins
    /  2581                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2581                           IF CONT_M > 0
    /  2581 31                        ins
    /  2582                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2582                           IF CONT_M > 0
    /  2582 31                        ins
    /  2583                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2583                           IF CONT_M > 0
    /  2583 31                        ins
    /  2584                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2584                           ENDIF
    /  2584                           ENDIF
    /  2584                           ENDIF
    /  2584                           ENDIF
    /  2584                           ENDIF
    /  2584                           ENDIF
    /  2584                           ENDIF
  840  2584 6C0B                      inc             11,x            ;se recupera el dato
  841  2586                           %PLAY_WRT                       ;se agrega la posición al array de barcos atacados
    /  2586 E60C                      ldab            12,x
    /  2588 37                        pshb                            ;se envía letra (fila)
    /  2589 E60B                      ldab            11,x
    /  258B 37                        pshb                            ;se envía num (columna)
    /  258C 1AEE0E                    ldy             14,x
    /  258F 183C                      pshy                            ;se envía inicio de array
    /  2591 E608                      ldab            8,x
    /  2593 37                        pshb                            ;se envía jugador atacado
    /  2594 BD27F7                    jsr             play_wrt
    /  2597                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  2597                           IF CONT_M > 0
    /  2597 31                        ins
    /  2598                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2598                           IF CONT_M > 0
    /  2598 31                        ins
    /  2599                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2599                           IF CONT_M > 0
    /  2599 31                        ins
    /  259A                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  259A                           IF CONT_M > 0
    /  259A 31                        ins
    /  259B                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  259B                           IF CONT_M > 0
    /  259B 31                        ins
    /  259C                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  259C                           ENDIF
    /  259C                           ENDIF
    /  259C                           ENDIF
    /  259C                           ENDIF
    /  259C                           ENDIF
    /  259C                           ENDIF
  842  259C                           %RESTORE
    /  259C 1838                      puly
    /  259E 38                        pulx
    /  259F 33                        pulb
    /  25A0 32                        pula
  843  25A1 39                        rts
  844                 
  845  25A2           gp_shi_u        EQU             *
  846  25A2 E60C                      ldab            12,x
  847  25A4 C10A                      cmpb            #MIN_F
  848  25A6 276D                      beq             gp_shi_d        ;si está en el borde superior, se continúa
  849  25A8 E60C                      ldab            12,x
  850  25AA 5A                        decb                            ;se va a la posición de arriba
  851  25AB 37                        pshb                            ;se envía la letra (fila)
  852  25AC E60B                      ldab            11,x
  853  25AE 37                        pshb                            ;se envía el num (columna)
  854  25AF 1AEE0E                    ldy             14,x
  855  25B2 183C                      pshy                            ;se envía el inicio del arreglo de barcos atacados
  856  25B4 E608                      ldab            8,x
  857  25B6 37                        pshb                            ;se envía el jugador atacado
  858  25B7 BD27A0                    jsr             play_src        ;se busca la posición de arriba
  859  25BA                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  25BA                           IF CONT_M > 0
    /  25BA 31                        ins
    /  25BB                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  25BB                           IF CONT_M > 0
    /  25BB 31                        ins
    /  25BC                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  25BC                           IF CONT_M > 0
    /  25BC 31                        ins
    /  25BD                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  25BD                           IF CONT_M > 0
    /  25BD 31                        ins
    /  25BE                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  25BE                           IF CONT_M > 0
    /  25BE 31                        ins
    /  25BF                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  25BF                           ENDIF
    /  25BF                           ENDIF
    /  25BF                           ENDIF
    /  25BF                           ENDIF
    /  25BF                           ENDIF
    /  25BF                           ENDIF
  860  25BF 2454                      bcc             gp_shi_d        ;si no había barco atacado arriba, se busca abajo
  861  25C1                           %WRITEPOS       #SUNK_SHI       
    /  25C1 C690                      ldab            #SUNK_SHI
    /  25C3 37                        pshb                            ;se envía el byte a escribir
    /  25C4 E60C                      ldab            12,x
    /  25C6 37                        pshb                            ;se envía letra (fila)
    /  25C7 E60B                      ldab            11,x
    /  25C9 37                        pshb                            ;se envía num (columna)
    /  25CA 1AEE09                    ldy             9,x
    /  25CD 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  25CF E608                      ldab            8,x
    /  25D1 37                        pshb                            ;se envía jugador atacado
    /  25D2 BD276F                    jsr             writepos
    /  25D5                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  25D5                           IF CONT_M > 0
    /  25D5 31                        ins
    /  25D6                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  25D6                           IF CONT_M > 0
    /  25D6 31                        ins
    /  25D7                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  25D7                           IF CONT_M > 0
    /  25D7 31                        ins
    /  25D8                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  25D8                           IF CONT_M > 0
    /  25D8 31                        ins
    /  25D9                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  25D9                           IF CONT_M > 0
    /  25D9 31                        ins
    /  25DA                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  25DA                           IF CONT_M > 0
    /  25DA 31                        ins
    /  25DB                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  25DB                           ENDIF
    /  25DB                           ENDIF
    /  25DB                           ENDIF
    /  25DB                           ENDIF
    /  25DB                           ENDIF
    /  25DB                           ENDIF
    /  25DB                           ENDIF
  862  25DB 6A0C                      dec             12,x
  863  25DD                           %WRITEPOS       #SUNK_SHI       ;se "hunde" a TODO el carguero
    /  25DD C690                      ldab            #SUNK_SHI
    /  25DF 37                        pshb                            ;se envía el byte a escribir
    /  25E0 E60C                      ldab            12,x
    /  25E2 37                        pshb                            ;se envía letra (fila)
    /  25E3 E60B                      ldab            11,x
    /  25E5 37                        pshb                            ;se envía num (columna)
    /  25E6 1AEE09                    ldy             9,x
    /  25E9 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  25EB E608                      ldab            8,x
    /  25ED 37                        pshb                            ;se envía jugador atacado
    /  25EE BD276F                    jsr             writepos
    /  25F1                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  25F1                           IF CONT_M > 0
    /  25F1 31                        ins
    /  25F2                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  25F2                           IF CONT_M > 0
    /  25F2 31                        ins
    /  25F3                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  25F3                           IF CONT_M > 0
    /  25F3 31                        ins
    /  25F4                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  25F4                           IF CONT_M > 0
    /  25F4 31                        ins
    /  25F5                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  25F5                           IF CONT_M > 0
    /  25F5 31                        ins
    /  25F6                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  25F6                           IF CONT_M > 0
    /  25F6 31                        ins
    /  25F7                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  25F7                           ENDIF
    /  25F7                           ENDIF
    /  25F7                           ENDIF
    /  25F7                           ENDIF
    /  25F7                           ENDIF
    /  25F7                           ENDIF
    /  25F7                           ENDIF
  864  25F7 6C0C                      inc             12,x            ;se recupera el dato
  865  25F9                           %PLAY_WRT                       ;se agrega la posición al array de barcos atacados
    /  25F9 E60C                      ldab            12,x
    /  25FB 37                        pshb                            ;se envía letra (fila)
    /  25FC E60B                      ldab            11,x
    /  25FE 37                        pshb                            ;se envía num (columna)
    /  25FF 1AEE0E                    ldy             14,x
    /  2602 183C                      pshy                            ;se envía inicio de array
    /  2604 E608                      ldab            8,x
    /  2606 37                        pshb                            ;se envía jugador atacado
    /  2607 BD27F7                    jsr             play_wrt
    /  260A                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  260A                           IF CONT_M > 0
    /  260A 31                        ins
    /  260B                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  260B                           IF CONT_M > 0
    /  260B 31                        ins
    /  260C                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  260C                           IF CONT_M > 0
    /  260C 31                        ins
    /  260D                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  260D                           IF CONT_M > 0
    /  260D 31                        ins
    /  260E                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  260E                           IF CONT_M > 0
    /  260E 31                        ins
    /  260F                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  260F                           ENDIF
    /  260F                           ENDIF
    /  260F                           ENDIF
    /  260F                           ENDIF
    /  260F                           ENDIF
    /  260F                           ENDIF
  866  260F                           %RESTORE
    /  260F 1838                      puly
    /  2611 38                        pulx
    /  2612 33                        pulb
    /  2613 32                        pula
  867  2614 39                        rts
  868                 
  869  2615           gp_shi_d        EQU             *
  870  2615 E60C                      ldab            12,x
  871  2617 C10F                      cmpb            #MAX_F
  872  2619 276D                      beq             gp_shi_h        ;si está en el borde inferior, se continúa
  873  261B E60C                      ldab            12,x
  874  261D 5C                        incb                            ;se va a la posición de abajo
  875  261E 37                        pshb                            ;se envía la letra (fila)
  876  261F E60B                      ldab            11,x
  877  2621 37                        pshb                            ;se envía el num (columna)
  878  2622 1AEE0E                    ldy             14,x
  879  2625 183C                      pshy                            ;se envía el inicio del arreglo de barcos atacados
  880  2627 E608                      ldab            8,x
  881  2629 37                        pshb                            ;se envía el jugador atacado
  882  262A BD27A0                    jsr             play_src        ;se busca la posición de abajo
  883  262D                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  262D                           IF CONT_M > 0
    /  262D 31                        ins
    /  262E                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  262E                           IF CONT_M > 0
    /  262E 31                        ins
    /  262F                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  262F                           IF CONT_M > 0
    /  262F 31                        ins
    /  2630                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2630                           IF CONT_M > 0
    /  2630 31                        ins
    /  2631                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2631                           IF CONT_M > 0
    /  2631 31                        ins
    /  2632                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2632                           ENDIF
    /  2632                           ENDIF
    /  2632                           ENDIF
    /  2632                           ENDIF
    /  2632                           ENDIF
    /  2632                           ENDIF
  884  2632 2454                      bcc             gp_shi_h        ;si no había barco atacado abajo, el carguero está tocado
  885  2634                           %WRITEPOS       #SUNK_SHI       
    /  2634 C690                      ldab            #SUNK_SHI
    /  2636 37                        pshb                            ;se envía el byte a escribir
    /  2637 E60C                      ldab            12,x
    /  2639 37                        pshb                            ;se envía letra (fila)
    /  263A E60B                      ldab            11,x
    /  263C 37                        pshb                            ;se envía num (columna)
    /  263D 1AEE09                    ldy             9,x
    /  2640 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  2642 E608                      ldab            8,x
    /  2644 37                        pshb                            ;se envía jugador atacado
    /  2645 BD276F                    jsr             writepos
    /  2648                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  2648                           IF CONT_M > 0
    /  2648 31                        ins
    /  2649                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  2649                           IF CONT_M > 0
    /  2649 31                        ins
    /  264A                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  264A                           IF CONT_M > 0
    /  264A 31                        ins
    /  264B                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  264B                           IF CONT_M > 0
    /  264B 31                        ins
    /  264C                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  264C                           IF CONT_M > 0
    /  264C 31                        ins
    /  264D                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  264D                           IF CONT_M > 0
    /  264D 31                        ins
    /  264E                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  264E                           ENDIF
    /  264E                           ENDIF
    /  264E                           ENDIF
    /  264E                           ENDIF
    /  264E                           ENDIF
    /  264E                           ENDIF
    /  264E                           ENDIF
  886  264E 6C0C                      inc             12,x
  887  2650                           %WRITEPOS       #SUNK_SHI       ;se "hunde" a TODO el carguero
    /  2650 C690                      ldab            #SUNK_SHI
    /  2652 37                        pshb                            ;se envía el byte a escribir
    /  2653 E60C                      ldab            12,x
    /  2655 37                        pshb                            ;se envía letra (fila)
    /  2656 E60B                      ldab            11,x
    /  2658 37                        pshb                            ;se envía num (columna)
    /  2659 1AEE09                    ldy             9,x
    /  265C 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  265E E608                      ldab            8,x
    /  2660 37                        pshb                            ;se envía jugador atacado
    /  2661 BD276F                    jsr             writepos
    /  2664                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  2664                           IF CONT_M > 0
    /  2664 31                        ins
    /  2665                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  2665                           IF CONT_M > 0
    /  2665 31                        ins
    /  2666                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  2666                           IF CONT_M > 0
    /  2666 31                        ins
    /  2667                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  2667                           IF CONT_M > 0
    /  2667 31                        ins
    /  2668                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2668                           IF CONT_M > 0
    /  2668 31                        ins
    /  2669                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2669                           IF CONT_M > 0
    /  2669 31                        ins
    /  266A                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  266A                           ENDIF
    /  266A                           ENDIF
    /  266A                           ENDIF
    /  266A                           ENDIF
    /  266A                           ENDIF
    /  266A                           ENDIF
    /  266A                           ENDIF
  888  266A 6A0C                      dec             12,x            ;se recupera el dato
  889  266C                           %PLAY_WRT                       ;se agrega la posición al array de barcos atacados
    /  266C E60C                      ldab            12,x
    /  266E 37                        pshb                            ;se envía letra (fila)
    /  266F E60B                      ldab            11,x
    /  2671 37                        pshb                            ;se envía num (columna)
    /  2672 1AEE0E                    ldy             14,x
    /  2675 183C                      pshy                            ;se envía inicio de array
    /  2677 E608                      ldab            8,x
    /  2679 37                        pshb                            ;se envía jugador atacado
    /  267A BD27F7                    jsr             play_wrt
    /  267D                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  267D                           IF CONT_M > 0
    /  267D 31                        ins
    /  267E                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  267E                           IF CONT_M > 0
    /  267E 31                        ins
    /  267F                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  267F                           IF CONT_M > 0
    /  267F 31                        ins
    /  2680                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  2680                           IF CONT_M > 0
    /  2680 31                        ins
    /  2681                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  2681                           IF CONT_M > 0
    /  2681 31                        ins
    /  2682                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  2682                           ENDIF
    /  2682                           ENDIF
    /  2682                           ENDIF
    /  2682                           ENDIF
    /  2682                           ENDIF
    /  2682                           ENDIF
  890  2682                           %RESTORE
    /  2682 1838                      puly
    /  2684 38                        pulx
    /  2685 33                        pulb
    /  2686 32                        pula
  891  2687 39                        rts
  892                 
  893  2688           gp_shi_h        EQU             *
  894  2688                           %WRITEPOS       #HIT            ;se marca al carguero como tocado
    /  2688 C6B0                      ldab            #HIT
    /  268A 37                        pshb                            ;se envía el byte a escribir
    /  268B E60C                      ldab            12,x
    /  268D 37                        pshb                            ;se envía letra (fila)
    /  268E E60B                      ldab            11,x
    /  2690 37                        pshb                            ;se envía num (columna)
    /  2691 1AEE09                    ldy             9,x
    /  2694 183C                      pshy                            ;se envía dirección de inicio de matriz
    /  2696 E608                      ldab            8,x
    /  2698 37                        pshb                            ;se envía jugador atacado
    /  2699 BD276F                    jsr             writepos
    /  269C                           %CLRST          6
    /  0006           CONT_M          SET     6
    /  269C                           IF CONT_M > 0
    /  269C 31                        ins
    /  269D                           %CLRST  CONT_M-1
    /  0005           CONT_M          SET     CONT_M-1
    /  269D                           IF CONT_M > 0
    /  269D 31                        ins
    /  269E                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  269E                           IF CONT_M > 0
    /  269E 31                        ins
    /  269F                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  269F                           IF CONT_M > 0
    /  269F 31                        ins
    /  26A0                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  26A0                           IF CONT_M > 0
    /  26A0 31                        ins
    /  26A1                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  26A1                           IF CONT_M > 0
    /  26A1 31                        ins
    /  26A2                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  26A2                           ENDIF
    /  26A2                           ENDIF
    /  26A2                           ENDIF
    /  26A2                           ENDIF
    /  26A2                           ENDIF
    /  26A2                           ENDIF
    /  26A2                           ENDIF
  895  26A2                           %PLAY_WRT                       ;se agrega la posición al array de barcos atacados
    /  26A2 E60C                      ldab            12,x
    /  26A4 37                        pshb                            ;se envía letra (fila)
    /  26A5 E60B                      ldab            11,x
    /  26A7 37                        pshb                            ;se envía num (columna)
    /  26A8 1AEE0E                    ldy             14,x
    /  26AB 183C                      pshy                            ;se envía inicio de array
    /  26AD E608                      ldab            8,x
    /  26AF 37                        pshb                            ;se envía jugador atacado
    /  26B0 BD27F7                    jsr             play_wrt
    /  26B3                           %CLRST          5
    /  0005           CONT_M          SET     5
    /  26B3                           IF CONT_M > 0
    /  26B3 31                        ins
    /  26B4                           %CLRST  CONT_M-1
    /  0004           CONT_M          SET     CONT_M-1
    /  26B4                           IF CONT_M > 0
    /  26B4 31                        ins
    /  26B5                           %CLRST  CONT_M-1
    /  0003           CONT_M          SET     CONT_M-1
    /  26B5                           IF CONT_M > 0
    /  26B5 31                        ins
    /  26B6                           %CLRST  CONT_M-1
    /  0002           CONT_M          SET     CONT_M-1
    /  26B6                           IF CONT_M > 0
    /  26B6 31                        ins
    /  26B7                           %CLRST  CONT_M-1
    /  0001           CONT_M          SET     CONT_M-1
    /  26B7                           IF CONT_M > 0
    /  26B7 31                        ins
    /  26B8                           %CLRST  CONT_M-1
    /  0000           CONT_M          SET     CONT_M-1
    /                                 IF CONT_M > 0
    /                                 ins
    /                                 %CLRST  CONT_M-1
    /  26B8                           ENDIF
    /  26B8                           ENDIF
    /  26B8                           ENDIF
    /  26B8                           ENDIF
    /  26B8                           ENDIF
    /  26B8                           ENDIF
  896  26B8                           %RESTORE
    /  26B8 1838                      puly
    /  26BA 38                        pulx
    /  26BB 33                        pulb
    /  26BC 32                        pula
  897  26BD 39                        rts
  898                 
  899                 *==========================================================================
  900                 * subrutina def_ships
  901                 * Función: Determina los valores de cargueros y submarinos a utilizar.
  902                 * Recibe: Nada
  903                 * Devuelve: Cantidad de cargueros y submarinos en memorias correspondientes.
  904                 * Requiere:
  905                 *==========================================================================
  906  26BE           def_ships       EQU             *
  907  26BE                           %BACKUP
    /  26BE 36                        psha
    /  26BF 37                        pshb
    /  26C0 3C                        pshx
    /  26C1 183C                      pshy
  908                 
  909  26C3           wait_nsu        EQU             *
  910  26C3 CE42CE                    ldx             #subm
  911  26C6 BD28EE                    jsr             show
  912                 
  913  26C9 BD2902                    jsr             read_kb
  914  26CC 4D                        tsta
  915  26CD 2BF4                      bmi             wait_nsu
  916  26CF 36                        psha
  917  26D0                           %EXPECT         B_fire
    /                                 
    /  26D0 BD2902    expe0027          jsr             read_kb
    /  26D3 4D                        tsta
    /  26D4 2BFA                      bmi             expe0027
    /  26D6 810B                      cmpa            #B_fire
    /  26D8 26F6                      bne             expe0027
    /                 
  918  26DA 32                        pula
  919                 
  920  26DB CE4265                    ldx             #kb_value
  921  26DE 16                        tab
  922  26DF 3A                        abx
  923  26E0 A600                      ldaa            0,x             ;se obtiene el valor ingresado ya codificado
  924                 
  925  26E2 8105                      cmpa            #SUB            ;se controla que no sea menor al máximo de submarinos
  926  26E4 22DD                      bhi             wait_nsu
  927  26E6 B7425B                    staa            cant_sub        ;se guarda la cantidad de submarinos
  928                 
  929  26E9           wait_nsh        EQU             *
  930  26E9 CE42D3                    ldx             #carg
  931  26EC BD28EE                    jsr             show
  932                 
  933  26EF BD2902                    jsr             read_kb
  934  26F2 4D                        tsta
  935  26F3 2BF4                      bmi             wait_nsh
  936  26F5 36                        psha
  937  26F6                           %EXPECT         B_fire
    /                                 
    /  26F6 BD2902    expe0028          jsr             read_kb
    /  26F9 4D                        tsta
    /  26FA 2BFA                      bmi             expe0028
    /  26FC 810B                      cmpa            #B_fire
    /  26FE 26F6                      bne             expe0028
    /                 
  938  2700 32                        pula
  939                 
  940  2701 CE4265                    ldx             #kb_value
  941  2704 16                        tab
  942  2705 3A                        abx
  943  2706 A600                      ldaa            0,x             ;se obtiene el valor ingresado ya codificado
  944                 
  945  2708 8104                      cmpa            #SHI            ;se controla que no sea menor al máximo de submarinos
  946  270A 22DD                      bhi             wait_nsh
  947  270C B7425C                    staa            cant_shi        ;se guarda la cantidad de submarinos
  948                 
  949  270F                           %RESTORE
    /  270F 1838                      puly
    /  2711 38                        pulx
    /  2712 33                        pulb
    /  2713 32                        pula
  950  2714 39                        rts
  951                 
  952                 *====================================================================================
  953                 * Subrutina "MIRROR"
  954                 *
  955                 * Descripción:  Esta subrutina copia el contenido de las posiciones de un array fuente
  956                 *               a un espacio de memoria destino.
  957                 * Parámetros de entrada:
  958                 *               - Dirección de comienzo de array FUENTE
  959                 *               - Número de arreglo contenido en otro arreglo (número de jugador)(0 en adelante)
  960                 *               - Dirección de DESTINO de la copia 
  961                 *               - Número de posiciones a copiar (un byte, hasta 255 posiciones.)
  962                 *               - Número de arreglo (de 0 en adelante) (número de jugador)
  963                 *
  964                 *       Todos los parámetros se reciben por stack en el orden indicado. 
  965                 *       Se destruirá el dato de la dirección del array de origen.
  966                 *               
  967                 * Parámetros de salida: NINGUNO
  968                 *       
  969                 *
  970                 * Consideraciones:
  971                 *               - Luego de invocada, se debe normalizar el stack en 6 posiciones
  972                 *
  973                 *====================================================================================
  974                 
  975  2715           mirror          EQU             *       
  976                         
  977  2715                           %BACKUP
    /  2715 36                        psha
    /  2716 37                        pshb
    /  2717 3C                        pshx
    /  2718 183C                      pshy
  978  271A 30                        tsx                             ;creo frame pointer
  979  271B A60B                      ldaa            11,x            ;cargo número de jugador
  980  271D E608                      ldab            8,x             ;cargo longitud de la copia (del array a copiar)
  981  271F 3D                        mul                             ;obtengo offset de jugador
  982  2720 E30C                      addd            12,x            ;sumo offset de jugador
  983  2722 ED0C                      std             12,x            ;guardo la dirección con offset del array fuente
  984                 
  985  2724 A608                      ldaa            8,x             ;cargo longitud de copia en contador
  986  2726 2710                      beq             mi_end          ;si es cero, vuelvo desde subrutina
  987  2728 1AEE09                    ldy             9,x             ;cargo índice a destino de la copia.
  988  272B EE0C                      ldx             12,x            ;cargo índice a array origen de copia.
  989                 
  990  272D           mi_loop         EQU             *
  991                 
  992  272D E600                      ldab            0,x             ;cargo byte a copiar
  993  272F 18E700                    stab            0,y             ;copio byte en destino
  994  2732 08                        inx                             ;siguiente byte
  995  2733 1808                      iny                             ;siguiente byte
  996  2735 4A                        deca                            ;decremento contador
  997  2736 26F5                      bne             mi_loop
  998                 
  999  2738           mi_end          EQU             *
 1000                 
 1001  2738                           %RESTORE
    /  2738 1838                      puly
    /  273A 38                        pulx
    /  273B 33                        pulb
    /  273C 32                        pula
 1002                         
 1003  273D 39                        rts     
 1004                                 
 1005                                                 
 1006                 *====================================================================================
 1007                 * Subrutina "FETCHPOS"
 1008                 *
 1009                 * Descripción:  La subrutina busca en un array de tres dimensiones una 
 1010                 *               determinada posición, y devuelve el byte que se encuentra
 1011                 *               en esa posición por stack. Subrutina limitada a longitud
 1012                 *               de elementos del array de un byte.
 1013                 *
 1014                 * Parámetros de entrada:
 1015                 *               - FILA del array (En HEX, de $0A (fil.0) en adelante)
 1016                 *               - COLUMNA del array (en HEX)
 1017                 *               - Dirección de comienzo del arreglo (2 bytes)
 1018                 *               - Número de arreglo (de 0 en adelante) (número de jugador)
 1019                 *
 1020                 *       Todos los parámetros se reciben por stack en el orden indicado.
 1021                 *       Se destruirá el dato del índice al arreglo.
 1022                 *               
 1023                 * Parámetros de salida:
 1024                 *               - Byte encontrado en esa posición (se devuelve por stack)
 1025                 *
 1026                 *
 1027                 * Consideraciones:
 1028                 *               - Antes de recuperar el byte en stack se debe normalizar el mismo
 1029                 *                 en 4 posiciones (4 bytes)
 1030                 *               - Requiere definición de constante "ARRAY_L"
 1031                 *
 1032                 *====================================================================================
 1033                 
 1034  273E           fetchpos        EQU             *
 1035                 
 1036  273E                           %BACKUP
    /  273E 36                        psha
    /  273F 37                        pshb
    /  2740 3C                        pshx
    /  2741 183C                      pshy
 1037  2743 30                        tsx                             ;creo frame pointer
 1038  2744 A608                      ldaa            8,x             ;cargo numero de jugador
 1039  2746 C624                      ldab            #ARRAY_L        ;cargo longitud del arreglo (MAX 255 bytes)
 1040  2748 3D                        mul                             ;obtengo offset de jugador
 1041  2749 E309                      addd            9,x             ;sumo offset de jugador a top of array
 1042  274B ED09                      std             9,x             ;obtengo direccion al arreglo del jugador
 1043                 
 1044  274D A60C                      ldaa            12,x            ;cargo coordenada letra (FILA)
 1045  274F C60A                      ldab            #NORM           ;cargo valor de normalización de filas
 1046  2751 10                        sba                             ;obtengo numero de fila
 1047  2752 C606                      ldab            #COL            ;cargo longitud de fila
 1048  2754 3D                        mul                             ;obtengo offset de fila
 1049  2755 E309                      addd            9,x             ;sumo offset de fila a la dirección del arreglo del jugador
 1050  2757 ED09                      std             9,x             ;obtengo dirección a la fila que se desea
 1051                 
 1052  2759 E60B                      ldab            11,x            ;cargo coordenada (offset) de columna
 1053  275B 5A                        decb                            ;normalizo offset de columna
 1054  275C 4F                        clra                            ;borro AccA para tener el valor de AccB en AccD
 1055  275D E309                      addd            9,x             ;sumo offset de columna a la dirección temporal
 1056  275F ED09                      std             9,x             ;guardo en stack la dirección del byte a consultar
 1057                 
 1058  2761 1AEE09                    ldy             9,x             ;cargo en IY la dirección del byte que se desea obtener
 1059  2764 18A600                    ldaa            0,y             ;cargo el byte a devolver en AccA
 1060  2767 A70C                      staa            12,x            ;guardo el byte a devolver en stack
 1061  2769                           %RESTORE
    /  2769 1838                      puly
    /  276B 38                        pulx
    /  276C 33                        pulb
    /  276D 32                        pula
 1062                                 
 1063  276E 39                        rts
 1064                                 
 1065                                 
 1066                 
 1067                 *====================================================================================
 1068                 * Subrutina "WRITEPOS"
 1069                 *
 1070                 * Descripción:  La subrutina busca en un array de tres dimensiones una 
 1071                 *               determinada posición, y escribe en la misma un byte de
 1072                 *               datos que será recibido como parámetro de entrada por stack.
 1073                 *
 1074                 * Parámetros de entrada:
 1075                 *               - BYTE a escribir en la posición indicada
 1076                 *               - FILA del array (En HEX, de $0A (fil.0) en adelante)
 1077                 *               - COLUMNA del array (en HEX)
 1078                 *               - Dirección de comienzo del arreglo (2 bytes)
 1079                 *               - Número de arreglo (de 0 en adelante) (número de jugador)
 1080                 *
 1081                 *       Todos los parámetros se reciben por stack en el orden indicado. 
 1082                 *       Se destruirá el dato del índice al arreglo.
 1083                 *               
 1084                 * Parámetros de salida: NINGUNO
 1085                 *       
 1086                 *
 1087                 * Consideraciones:
 1088                 *               - Luego de invocada, se debe normalizar el stack en 6 posiciones
 1089                 *               - Requiere definición de constante "ARRAY_L"
 1090                 *
 1091                 *====================================================================================
 1092                 
 1093  276F           writepos        EQU             *
 1094                 
 1095  276F                           %BACKUP
    /  276F 36                        psha
    /  2770 37                        pshb
    /  2771 3C                        pshx
    /  2772 183C                      pshy
 1096  2774 30                        tsx                             ;creo frame pointer
 1097  2775 A608                      ldaa            8,x             ;cargo numero de jugador
 1098  2777 C624                      ldab            #ARRAY_L        ;cargo longitud del arreglo (MAX 255 bytes)
 1099  2779 3D                        mul                             ;obtengo offset de jugador
 1100  277A E309                      addd            9,x             ;sumo offset de jugador a top of array
 1101  277C ED09                      std             9,x             ;obtengo direccion al arreglo del jugador
 1102                 
 1103  277E A60C                      ldaa            12,x            ;cargo coordenada letra (FILA)
 1104  2780 C60A                      ldab            #NORM           ;cargo valor de normalización de filas
 1105  2782 10                        sba                             ;obtengo numero de fila
 1106  2783 C606                      ldab            #COL            ;cargo longitud de fila
 1107  2785 3D                        mul                             ;obtengo offset de fila
 1108  2786 E309                      addd            9,x             ;sumo offset de fila a la dirección del arreglo del jugador
 1109  2788 ED09                      std             9,x             ;obtengo dirección a la fila que se desea
 1110                 
 1111  278A E60B                      ldab            11,x            ;cargo coordenada (offset) de columna
 1112  278C 5A                        decb                            ;normalizo offset de columna
 1113  278D 4F                        clra                            ;borro AccA para tener el valor de AccB en AccD
 1114  278E E309                      addd            9,x             ;sumo offset de columna a la dirección temporal
 1115  2790 ED09                      std             9,x             ;guardo en stack la dirección del byte a consultar
 1116                 
 1117  2792 1AEE09                    ldy             9,x             ;cargo en IY la dirección donde se desea escribir
 1118  2795 A60D                      ldaa            13,x            ;cargo en AccA el byte que se quiere escribir en el arreglo
 1119  2797 18A700                    staa            0,y             ;escribo el byte sobre el arreglo
 1120  279A                           %RESTORE
    /  279A 1838                      puly
    /  279C 38                        pulx
    /  279D 33                        pulb
    /  279E 32                        pula
 1121                                 
 1122  279F 39                        rts
 1123                 *====================================================================================
 1124                 * Subrutina "PLAY_SRC"
 1125                 *
 1126                 * Descripción:  Esta subrutina busca dos bytes consecutivos (posicion jugada) dentro de un arreglo.
 1127                 *               El valor $00 podrá estar en el array solo como terminador
 1128                 * Parámetros de entrada:
 1129                 *               - Byte1 a buscar (en este caso, n° fila)
 1130                 *               - Byte2 a buscar (en este caso, n° columna)
 1131                 *               - Dirección de inicio del array
 1132                 *               - Número de jugador (0 o mayor)
 1133                 *
 1134                 *       Todos los parámetros se reciben por stack en el orden indicado. 
 1135                 *               
 1136                 * Parámetros de salida:
 1137                 *               - Carry en 1, si se encontró la posición.
 1138                 *       
 1139                 *
 1140                 * Consideraciones:
 1141                 *               - Luego de invocada, se debe normalizar el stack en 5 posiciones antes de
 1142                 *                 recuperar el parámetro de salida.
 1143                 *
 1144                 *====================================================================================
 1145                 
 1146  27A0           play_src        EQU             *               
 1147                                         
 1148  27A0                           %BACKUP
    /  27A0 36                        psha
    /  27A1 37                        pshb
    /  27A2 3C                        pshx
    /  27A3 183C                      pshy
 1149  27A5 30                        tsx                             ;creo frame pointer
 1150  27A6 A608                      ldaa            8,x             ;cargo número de array (jugador)
 1151  27A8 C61B                      ldab            #HITSIZE        ;cargo tamaño de array de 1 jugador
 1152  27AA 3D                        mul                             ;obtengo offset de jugador
 1153  27AB E309                      addd            9,x             ;sumo el offset de jugador al puntero al array
 1154  27AD 188F                      xgdy                            ;obtengo puntero al array del jugador deseado
 1155                 
 1156  27AF           ps_loop         EQU             *
 1157                 
 1158  27AF 18A600                    ldaa            0,y             ;cargo byte1 a comparar
 1159  27B2 2718                      beq             ps_ntfnd        ;si encontré el terminador, el valor requerido no está en el array
 1160                 
 1161  27B4 A10C                      cmpa            12,x            ;comparo con el byte1 a buscar
 1162  27B6 2706                      beq             ps_next         ;si coinciden, busco el byte 2
 1163  27B8 1808                      iny                             ;me posiciono sobre siguiente byte1 a comparar
 1164  27BA 1808                      iny
 1165  27BC 20F1                      bra             ps_loop         ;vuelvo a comparar
 1166                 
 1167  27BE           ps_next         EQU             *
 1168                 
 1169  27BE 18E601                    ldab            1,y             ;cargo byte a continuación del anterior
 1170  27C1 1808                      iny                             ;me posiciono sobre siguiente byte1 a comparar
 1171  27C3 1808                      iny
 1172  27C5 E10B                      cmpb            11,x            ;comparo con byte2
 1173  27C7 26E6                      bne             ps_loop         ;si no son iguales, sigo buscando
 1174  27C9 0D                        sec                             ;set del carry para informar que se encontró el valor
 1175  27CA 2001                      bra             ps_end
 1176                                         
 1177  27CC           ps_ntfnd        EQU             *
 1178                 
 1179  27CC 0C                        clc                             ;carry en 0 para informar que no se encontró el valor
 1180                 
 1181  27CD           ps_end          EQU             *
 1182                                 
 1183  27CD                           %RESTORE
    /  27CD 1838                      puly
    /  27CF 38                        pulx
    /  27D0 33                        pulb
    /  27D1 32                        pula
 1184                 
 1185  27D2 39                        rts
 1186                 
 1187                 *====================================================================================
 1188                 * Subrutina "PLAY_CNT"
 1189                 *
 1190                 * Descripción:  Esta subrutina cuenta la cantidad de datos de dos bytes que se encuentran en una
 1191                 *               determinada zona de memoria configurada como array. Se supone que $00 no es un dato presente en dicho array, 
 1192                 *               usándose solamente como terminador del mismo.
 1193                 *
 1194                 * Parámetros de entrada:
 1195                 *               - Dirección de inicio del array
 1196                 *               - Número de jugador (0 o mayor)
 1197                 *
 1198                 *       Todos los parámetros se reciben por stack en el orden indicado. 
 1199                 *               
 1200                 * Parámetros de salida:
 1201                 *               - Cantidad de datos de dos bytes encontrados, por stack (máximo 255 datos).
 1202                 *       
 1203                 *
 1204                 * Consideraciones:
 1205                 *               - Luego de invocada, se debe normalizar el stack en 2 posiciones antes de
 1206                 *                 recuperar el parámetro de salida.
 1207                 *
 1208                 *====================================================================================
 1209                 
 1210  27D3           play_cnt        EQU             *
 1211                 
 1212  27D3                           %BACKUP
    /  27D3 36                        psha
    /  27D4 37                        pshb
    /  27D5 3C                        pshx
    /  27D6 183C                      pshy
 1213  27D8 30                        tsx                             ;creo frame pointer
 1214  27D9 A608                      ldaa            8,x             ;cargo número de array (jugador)
 1215  27DB C61B                      ldab            #HITSIZE        ;cargo tamaño de array de 1 jugador
 1216  27DD 3D                        mul                             ;obtengo offset de jugador
 1217  27DE E309                      addd            9,x             ;sumo el offset de jugador al puntero al array
 1218  27E0 188F                      xgdy                            ;obtengo puntero al array del jugador deseado
 1219  27E2 4F                        clra                            ;inicializo contador
 1220                                         
 1221  27E3           pc_loop         EQU             *               
 1222                                         
 1223  27E3 18E600                    ldab            0,y             ;cargo byte a comparar
 1224  27E6 2707                      beq             pc_end          ;si es terminador, terminé de buscar
 1225  27E8 1808                      iny                             ;si no es terminador, me posiciono sobre siguiente dato de 
 1226  27EA 1808                      iny                             ;2 bytes
 1227  27EC 4C                        inca                            ;incremento contador
 1228  27ED 20F4                      bra             pc_loop         ;vuelvo a comparar
 1229                                         
 1230  27EF           pc_end          EQU             *       
 1231                                         
 1232  27EF A70A                      staa            10,x            ;devuelvo valor por stack
 1233  27F1                           %RESTORE
    /  27F1 1838                      puly
    /  27F3 38                        pulx
    /  27F4 33                        pulb
    /  27F5 32                        pula
 1234                                 
 1235  27F6 39                        rts
 1236                 
 1237                 
 1238                 *====================================================================================
 1239                 * Subrutina "PLAY_WRT"
 1240                 *
 1241                 * Descripción:  Esta subrutina escribe dos bytes distintos (en este caso, la posición 
 1242                 *               jugada, compuesta de una letra y un número) en la primera posición "libre"
 1243                 *               de un array y en la siguiente. La subrutina escribirá los datos desde la primera posición con ceros
 1244                 *               que encuentre en el array, por lo que el mismo NO podrá contener el dato "$00" en ninguno
 1245                 *               de sus bytes, caso contrario la subrutina lo interpretará como vacío y sobreescribirá información. Se
 1246                 *               supone que el array tendrá por lo menos, dos posiciones libres.
 1247                 *
 1248                 * Parámetros de entrada:
 1249                 *               - Primer byte a escribir (en este caso, fila jugada)
 1250                 *               - Byte a escribir a continuación del primero (en este caso, columna jugada)
 1251                 *               - Dirección de inicio del array en el que se va a escribir
 1252                 *               - Número de jugador (0 o mayor)
 1253                 *
 1254                 *       Todos los parámetros se reciben por stack en el orden indicado. 
 1255                 *               
 1256                 * Parámetros de salida: NINGUNO
 1257                 *       
 1258                 *
 1259                 * Consideraciones:
 1260                 *               - Luego de invocada, se debe normalizar el stack en 5 posiciones
 1261                 *
 1262                 *====================================================================================
 1263                 
 1264  27F7           play_wrt        EQU             *
 1265                 
 1266  27F7                           %BACKUP
    /  27F7 36                        psha
    /  27F8 37                        pshb
    /  27F9 3C                        pshx
    /  27FA 183C                      pshy
 1267  27FC 30                        tsx                             ;creo frame pointer
 1268  27FD A608                      ldaa            8,x             ;cargo número de array (jugador)
 1269  27FF C61B                      ldab            #HITSIZE        ;cargo tamaño de array de 1 jugador
 1270  2801 3D                        mul                             ;obtengo offset de jugador
 1271  2802 E309                      addd            9,x             ;sumo el offset de jugador al puntero al array
 1272  2804 188F                      xgdy                            ;obtengo puntero al array del jugador deseado
 1273                 
 1274                 
 1275  2806           pw_loop         EQU             *
 1276                 
 1277  2806 18A600                    ldaa            0,y             ;cargo byte del array
 1278  2809 2704                      beq             pw_end          ;si es cero, entonces escribo los datos
 1279  280B 1808                      iny                             ;si no es cero, me posiciono sobre la siguiente posición
 1280  280D 20F7                      bra             pw_loop         ;vuelvo a buscar ceros
 1281                 
 1282  280F           pw_end          EQU             *
 1283                 
 1284  280F A60C                      ldaa            12,x            ;cargo primer byte a escribir
 1285  2811 18A700                    staa            0,y             ;guardo primer byte en memoria
 1286  2814 1808                      iny                             ;me posiciono en el siguiente byte
 1287  2816 A60B                      ldaa            11,x            ;cargo segundo byte a escribir
 1288  2818 18A700                    staa            0,y             ;guardo segundo byte en memoria
 1289  281B                           %RESTORE
    /  281B 1838                      puly
    /  281D 38                        pulx
    /  281E 33                        pulb
    /  281F 32                        pula
 1290                 
 1291  2820 39                        rts
 1292                 
 1293                 ***************************************************************************************
 1294                 *Subrutina "CLRZONE"
 1295                 *Función: "borra" (guarda ceros) una determinada zona de memoria.
 1296                 *         
 1297                 *
 1298                 * Parámetros de entrada: -Dirección de comienzo de sección a borrar (por stack)
 1299                 *                        -Longitud de zona de memoria (por stack)
 1300                 *                       
 1301                 *
 1302                 * Parámetros de salida: Ninguno
 1303                 *
 1304                 * consideraciones: 
 1305                 *                  - Incluir macros "%BACKUP" y "%RESTORE".
 1306                 *                                       
 1307                 *************************************************************************************** 
 1308  2821           clrzone         EQU     *
 1309                 
 1310  2821                           %BACKUP                         ;backup de registros en stack
    /  2821 36                        psha
    /  2822 37                        pshb
    /  2823 3C                        pshx
    /  2824 183C                      pshy
 1311                 
 1312  2826 30                        tsx
 1313  2827 A608                      ldaa    8,x                     ;cargo contador con longitud de zona a borrar
 1314  2829 EE09                      ldx     9,x                     ;cargo puntero zona de memoria a borrar
 1315  282B D600                      ldab    $00                     ;cargo el cero
 1316  282D           clr_loop        EQU     *
 1317  282D E700                      stab    0,x                     ;guardo caracter en posicion del array
 1318  282F 08                        inx                             ;siguiente posición     
 1319  2830 4A                        deca                            ;decremento contador
 1320  2831 26FA                      bne     clr_loop                ;si no es cero, escribo en la posición siguiente.
 1321                 
 1322  2833                           %RESTORE                        :restauro backup en registros
    /  2833 1838                      puly
    /  2835 38                        pulx
    /  2836 33                        pulb
    /  2837 32                        pula
 1323                 
 1324  2838 39                        rts
 1325                 
 1326                 *---------------------------------------
 1327                 * WhoPlays: subrutina para ver que 
 1328                 *           jugador juega
 1329                 *---------------------------------------
 1330                 
 1331  2839           whoplays        EQU             *
 1332                 
 1333  2839 BD2902    wait_ply        jsr             read_kb
 1334  283C 4D                        tsta
 1335  283D 2BFA                      bmi             wait_ply
 1336  283F 8103                      cmpa            #B_P1
 1337  2841 2708                      beq             play_p1
 1338  2843 8107                      cmpa            #B_P2
 1339  2845 26F2                      bne             wait_ply
 1340  2847 8600                      ldaa            #P1
 1341  2849 2002                      bra             ply_end
 1342                 
 1343  284B 8601      play_p1         ldaa            #P2
 1344  284D 39        ply_end         rts             
 1345                 
 1346                 *---------------------------------------
 1347                 * Input: subrutina que devuelve
 1348                 *        entrada para la batalla naval
 1349                 * AccA: Fila de la posicion jugada
 1350                 * AccB: Columna de la posicion jugada
 1351                 *---------------------------------------
 1352                 
 1353  284E           input           EQU             *
 1354                 
 1355                 * back up de registros
 1356  284E 3C                        pshx
 1357  284F 183C                      pshy
 1358                 
 1359                 * creo variables locales
 1360  2851 36                        psha
 1361  2852 36                        psha
 1362  2853 36                        psha
 1363                 
 1364                 * inicializo framepointer
 1365  2854 1830                      tsy
 1366                 
 1367                 * prendo el led
 1368  2856                           %LED_INV
    /  2856 B61000                    ldaa            PORTA
    /  2859 8840                      eora            #SHF_LED
    /  285B B71000                    staa            PORTA
 1369                 
 1370                 * inicializo el contador
 1371  285E 8603      inp_rest        ldaa            #INPUTS
 1372  2860 18A700                    staa            CONT,Y
 1373                                 
 1374                 * limpio el display
 1375  2863 CE4260                    ldx             #string
 1376  2866 8604                      ldaa            #4
 1377  2868 C620                      ldab            #ESP
 1378  286A BD29CC                    jsr             clrarray
 1379                 
 1380  286D BD29BB                    jsr             clr_dis
 1381                 
 1382  2870 86FF                      ldaa            #$FF
 1383  2872 B7425F                    staa            buffer
 1384                 
 1385                 * lectura de teclado
 1386  2875 BD2902    wait_kb         jsr             read_kb
 1387  2878 4D                        tsta
 1388  2879 2BFA                      bmi             wait_kb
 1389  287B B1425F                    cmpa            buffer
 1390  287E 27F5                      beq             wait_kb
 1391  2880 B7425F                    staa            buffer
 1392                                 
 1393  2883 810F                      cmpa            #B_reset
 1394  2885 27D7                      beq             inp_rest
 1395  2887 8103                      cmpa            #B_P1
 1396  2889 27D3                      beq             inp_rest
 1397  288B 8107                      cmpa            #B_P2
 1398  288D 27CF                      beq             inp_rest
 1399                 
 1400  288F 186A00                    dec             CONT,Y
 1401  2892 272B                      beq             chk_fire
 1402  2894 810B                      cmpa            #B_fire
 1403  2896 27C6                      beq             inp_rest
 1404  2898 36                        psha
 1405  2899 CE4265                    ldx             #kb_value
 1406  289C 16                        tab
 1407  289D 3A                        abx
 1408  289E A600                      ldaa            0,X             
 1409  28A0 183C                      pshy
 1410  28A2 18E600                    ldab            CONT,Y
 1411  28A5 183A                      aby
 1412  28A7 18A700                    staa            0,Y
 1413  28AA 1838                      puly
 1414                 
 1415  28AC 33                        pulb
 1416  28AD BD29AB                    jsr             to_ascii
 1417  28B0 17                        tba
 1418                                 
 1419  28B1 CE4260                    ldx             #string
 1420  28B4 BD299B                    jsr             sh_value
 1421                 
 1422  28B7 CE4260                    ldx             #string
 1423  28BA BD28EE                    jsr             show
 1424                 
 1425  28BD 20B6                      bra             wait_kb
 1426                 
 1427  28BF 810B      chk_fire        cmpa            #B_fire
 1428  28C1 269B                      bne             inp_rest
 1429  28C3 18A602                    ldaa            FILA_L,Y
 1430  28C6 810A                      cmpa            #MIN_FIL
 1431  28C8 2594                      blo             inp_rest
 1432  28CA 810F                      cmpa            #MAX_FIL
 1433  28CC 2290                      bhi             inp_rest
 1434  28CE 18A601                    ldaa            COL_L,Y
 1435  28D1 8101                      cmpa            #MIN_COL
 1436  28D3 2589                      blo             inp_rest
 1437  28D5 8106                      cmpa            #MAX_COL
 1438  28D7 2285                      bhi             inp_rest
 1439                 
 1440                 * apago el led
 1441  28D9                           %LED_INV
    /  28D9 B61000                    ldaa            PORTA
    /  28DC 8840                      eora            #SHF_LED
    /  28DE B71000                    staa            PORTA
 1442                 
 1443                 * libero variables locales
 1444  28E1 32                        pula
 1445  28E2 32                        pula
 1446  28E3 32                        pula
 1447                 
 1448  28E4 18A602    return          ldaa            FILA_L,Y
 1449  28E7 18E601                    ldab            COL_L,Y         
 1450                 
 1451                 * restore de registros
 1452  28EA 1838                      puly
 1453  28EC 38                        pulx
 1454                 
 1455  28ED 39                        rts
 1456                 
 1457                 *------------------------------------
 1458                 * Show: Por IX direccion de string de
 1459                 *       4 caracteres para imprimir
 1460                 *------------------------------------
 1461                 
 1462  28EE           show            EQU             *
 1463                 
 1464                 * back up de registros
 1465  28EE 3C                        pshx
 1466  28EF 37                        pshb
 1467  28F0 36                        psha
 1468                 
 1469                 * inicializo contador de posiciones
 1470  28F1 C604                      ldab            #LENGTH
 1471                                 
 1472                 * loop para enviar a cada posicion
 1473  28F3 5A        sh_loop         decb
 1474  28F4 2B08                      bmi             sh_end          ; si no pase por todas las posiciones
 1475  28F6 A600                      ldaa            0,X             ; tomo del string el caracter
 1476  28F8 BD29B4                    jsr             outchar         ; y lo imprimo en la posicion actual
 1477  28FB 08                        inx
 1478  28FC 20F5                      bra             sh_loop
 1479                 
 1480                 * restore de registros                          
 1481  28FE 32        sh_end          pula
 1482  28FF 33                        pulb
 1483  2900 38                        pulx
 1484  2901 39                        rts
 1485                 
 1486                 *----------------------------------------------
 1487                 * read_kb: AccA: tecla presionada
 1488                 *          o -1
 1489                 *----------------------------------------------
 1490                 
 1491  2902           read_kb         EQU             *
 1492                 
 1493                 * back up de registros
 1494  2902 3C                        pshx
 1495  2903 37                        pshb
 1496                 
 1497                 * creo espacio para variables locales
 1498  2904                           %MALLOC         1               ; variable mascara de filas
    /  2904                           IF 1 > 0
    /  2904 30                        tsx
    /  2905 8F                        xgdx
    /  2906 830001                    subd    #1
    /  2909 8F                        xgdx
    /  290A 35                        txs
    /  290B                           ENDIF
 1499  290B                           %MALLOC         1               ; variable mascara de columnas
    /  290B                           IF 1 > 0
    /  290B 30                        tsx
    /  290C 8F                        xgdx
    /  290D 830001                    subd    #1
    /  2910 8F                        xgdx
    /  2911 35                        txs
    /  2912                           ENDIF
 1500  2912                           %MALLOC         1               ; variable contador de columnas
    /  2912                           IF 1 > 0
    /  2912 30                        tsx
    /  2913 8F                        xgdx
    /  2914 830001                    subd    #1
    /  2917 8F                        xgdx
    /  2918 35                        txs
    /  2919                           ENDIF
 1501  2919                           %MALLOC         1               ; variable contador de tecla
    /  2919                           IF 1 > 0
    /  2919 30                        tsx
    /  291A 8F                        xgdx
    /  291B 830001                    subd    #1
    /  291E 8F                        xgdx
    /  291F 35                        txs
    /  2920                           ENDIF
 1502                 
 1503                 * inicializacion de variables
 1504  2920 30                        tsx                             ; framepointer para acceder a locales
 1505  2921 C604                      ldab            #LENGTH         ; contador de fila
 1506  2923 860E                      ldaa            #FIL0           ; mascara para la fila cero
 1507  2925 A703                      staa            MASK_FIL,X      
 1508  2927 8610                      ldaa            #COL0           ; mascara para la columna cero
 1509  2929 A702                      staa            MASK_COL,X
 1510  292B 4F                        clra                            ; contador de columna
 1511  292C A701                      staa            COL_CONT,X
 1512  292E A700                      staa            KB_PRESS,X      ; variable con numero de tecla
 1513                 
 1514                 * loop para barrer y mirar teclado matricial
 1515  2930 86FF      kb_loop         ldaa            #NONE
 1516  2932 5A                        decb                            
 1517  2933 2B2C                      bmi             kb_end          ; me fijo si recorrio todas las filas
 1518  2935 A603                      ldaa            MASK_FIL,X      ; enmascaro la siguiente fila
 1519  2937 B71003                    staa            ROWS
 1520  293A 0D                        sec                             ; carry para rotacion de byte
 1521  293B 49                        rola                            
 1522  293C A703                      staa            MASK_FIL,X      ; cambio variable mascara para la proxima fila
 1523                 
 1524  293E 8604                      ldaa            #LENGTH
 1525  2940 A701                      staa            COL_CONT,X
 1526  2942 8610                      ldaa            #COL0           ; inicializo variable para barrer
 1527  2944 A702                      staa            MASK_COL,X      ; la columna
 1528                 
 1529  2946 6A01      kb_col          dec             COL_CONT,X      ; me fijo si barrio todas las columnas
 1530  2948 2BE6                      bmi             kb_loop
 1531  294A B61005                    ldaa            COLS            ; leo el puerto de columnas
 1532  294D A402                      anda            MASK_COL,X      ; enmascaro columna
 1533  294F 2707                      beq             kb_hit          ; si es nulo apretaron un boton
 1534  2951 48                        lsla                            ; cambio mascara para proxima columna
 1535  2952 A702                      staa            MASK_COL,X
 1536  2954 6C00                      inc             KB_PRESS,X      ; incremento numero de tecla
 1537  2956 20EE                      bra             kb_col
 1538                 
 1539  2958 A600      kb_hit          ldaa            KB_PRESS,X      ; apretaron una tecla, lo comparo
 1540  295A B1425E                    cmpa            kb_buff         ; con la que fue apretada antes
 1541  295D 2602                      bne             kb_end          ; aviso por led
 1542                 
 1543  295F 86FF      kb_none         ldaa            #NONE           ; en caso de que no apreten nada
 1544                 
 1545  2961 B7425E    kb_end          staa            kb_buff         ; actualizo variable
 1546                                         
 1547                 * elimino variables locales
 1548  2964                           %RELMEM         1
    /  2964                           IF 1 > 0
    /  2964 30                        tsx
    /  2965 8F                        xgdx
    /  2966 C30001                    addd    #1
    /  2969 8F                        xgdx
    /  296A 35                        txs
    /  296B                           ENDIF           
 1549  296B                           %RELMEM         1
    /  296B                           IF 1 > 0
    /  296B 30                        tsx
    /  296C 8F                        xgdx
    /  296D C30001                    addd    #1
    /  2970 8F                        xgdx
    /  2971 35                        txs
    /  2972                           ENDIF           
 1550  2972                           %RELMEM         1
    /  2972                           IF 1 > 0
    /  2972 30                        tsx
    /  2973 8F                        xgdx
    /  2974 C30001                    addd    #1
    /  2977 8F                        xgdx
    /  2978 35                        txs
    /  2979                           ENDIF           
 1551  2979                           %RELMEM         1
    /  2979                           IF 1 > 0
    /  2979 30                        tsx
    /  297A 8F                        xgdx
    /  297B C30001                    addd    #1
    /  297E 8F                        xgdx
    /  297F 35                        txs
    /  2980                           ENDIF           
 1552                 
 1553                 * restore de registros
 1554  2980 33                        pulb
 1555  2981 38                        pulx
 1556                                 
 1557  2982 39                        rts
 1558                 
 1559                 *----------------------------------------------
 1560                 * init_kb: subrutina para inicializar teclado
 1561                 *----------------------------------------------
 1562                 
 1563  2983           init_kb         EQU             *
 1564                 
 1565                 * back up de registros
 1566  2983 36                        psha
 1567                 
 1568                 * inicializacion de teclado             
 1569  2984 86FF                      ldaa            #NONE
 1570  2986 B7425E                    staa            kb_buff
 1571                 
 1572                 * restore de registros
 1573  2989 32                        pula
 1574  298A 39                        rts
 1575                 
 1576                 *--------------------------------
 1577                 * Inicializa display (y teclado)
 1578                 *--------------------------------
 1579                 
 1580  298B           initdis         EQU             *
 1581                         
 1582  298B 36                        psha
 1583                 
 1584  298C 860F                      ldaa            #$0F       ;set for input/output
 1585  298E B71007                    staa            DDRC       ;C output
 1586  2991 B61002                    ldaa            PIOC       ;get current value
 1587  2994 84FE                      anda            #$FE       ;reset bit 0 to 0
 1588  2996 B71002                    staa            PIOC       ;send it out
 1589                         
 1590  2999 32                        pula
 1591  299A 39                        rts
 1592                 
 1593                 *--------------------------------------------------------------
 1594                 * sh_value: toma un string, desplaza los caracteres a izquierda
 1595                 *           y agrega un nuevo caracter
 1596                 *           IX: direccion del string
 1597                 *           AccA: nuevo valor
 1598                 *--------------------------------------------------------------
 1599                 
 1600  299B           sh_value        EQU             *
 1601                 
 1602                 * back up de registros
 1603  299B 3C                        pshx
 1604  299C 37                        pshb
 1605                 
 1606                 * loop para desplazar caracteres
 1607  299D E601      v_loop          ldab            1,X             ;tomo elemento siguiente en string
 1608  299F 2705                      beq             v_end
 1609  29A1 E700                      stab            0,X             ;y lo guardo en posicion actual
 1610  29A3 08                        inx
 1611  29A4 20F7                      bra             v_loop          
 1612                 
 1613  29A6 A700      v_end           staa            0,X             ;ingresa nuevo caracter en cadena desplazada
 1614                 
 1615                 * restore de registros
 1616  29A8 33                        pulb
 1617  29A9 38                        pulx
 1618  29AA 39                        rts
 1619                 
 1620                 *----------------------------------------------
 1621                 * toAscii: toma numero de boton del teclado
 1622                 *          y devuelve su correspondiente en
 1623                 *          ascii
 1624                 *          toma  AccB: valor del boton
 1625                 *          devuelve AccB: ascii
 1626                 *----------------------------------------------
 1627                 
 1628  29AB           to_ascii        EQU             *
 1629                 
 1630                 * back up de registros
 1631  29AB 3C                        pshx
 1632                 
 1633                 * inicializacion de variables
 1634  29AC CE4275                    ldx             #kb_ascii       ; apunto a string con caracteres asignados por tecla
 1635  29AF 3A                        abx                             ; me muevo en string con indice y recupero segun tecla presionada
 1636  29B0 E600                      ldab            0,X             
 1637                 
 1638                 * restore de registros
 1639  29B2 38                        pulx
 1640  29B3 39                        rts
 1641                 
 1642                 *--------------------------------
 1643                 *Outchar: ACCA: Carácter a enviar
 1644                 *           ACCB: Posición (0-3)
 1645                 *--------------------------------
 1646  29B4           outchar         EQU             *
 1647                         
 1648  29B4 F71005                    stab            PORTCL          ;set the position 
 1649  29B7 B71004                    staa            PORTB           ;set the character
 1650                         
 1651  29BA 39                        rts
 1652                 
 1653                 *-------------------------
 1654                 * clr_dis: Limpia display
 1655                 *-------------------------
 1656                 
 1657  29BB           clr_dis         EQU             *
 1658                 
 1659                 * hago back up de registros
 1660  29BB 37                        pshb
 1661  29BC 36                        psha
 1662                 
 1663                 * inicializo el contador de posiciones
 1664  29BD C604                      ldab            #LENGTH
 1665                 
 1666                 * loop para limpiar cada posicion
 1667  29BF 5A        clrloop         decb
 1668  29C0 2B07                      bmi             clr_end         ; si no pase por todas las posiciones
 1669  29C2 8620                      ldaa            #ESP            ; cargo en esta posicion espacio blanco
 1670  29C4 BD29B4                    jsr             outchar         ; y lo envio
 1671  29C7 20F6                      bra             clrloop         
 1672                 
 1673                 * restore de registros
 1674  29C9 32        clr_end         pula
 1675  29CA 33                        pulb
 1676  29CB 39                        rts
 1677                 
 1678                 *-------------------------------------------------------
 1679                 * clrarray: subrutina para limpiar un array dado
 1680                 * parametros: IX direccion del array
 1681                 *             AccA cantidad de elementos del array
 1682                 *             AccB caracter a poner
 1683                 *-------------------------------------------------------
 1684                 
 1685  29CC           clrarray        EQU             *
 1686                                 
 1687  29CC 4A        cra_loop        deca                            ;contador con cantidad de elementos a limpiar
 1688  29CD 2705                      beq             cra_end
 1689  29CF E700                      stab            0,X             ;reemplazar elemento por caracter a poner
 1690  29D1 08                        inx
 1691  29D2 20F8                      bra             cra_loop
 1692                                 
 1693  29D4 E700      cra_end         stab            0,X
 1694  29D6 39                        rts
 1695                 
 1696                 *=============================================
 1697                 *Subrutina winner: Recibe por stack un 1 si
 1698                 *gano el player 1 y un 0 si gano el player 2.
 1699                 *=============================================
 1700                 
 1701                                 
 1702  29D7           winner          EQU             *
 1703  29D7                           %BACKUP
    /  29D7 36                        psha
    /  29D8 37                        pshb
    /  29D9 3C                        pshx
    /  29DA 183C                      pshy
 1704  29DC 30                        tsx
 1705  29DD A608                      ldaa            8,x     ;recupero parametro enviado por stack
 1706  29DF 2708                      beq             win2
 1707                 
 1708  29E1           win1            EQU             *
 1709  29E1 CE42BA                    ldx             #string1
 1710  29E4 BD28EE                    jsr             show
 1711  29E7 2006                      bra             end
 1712                 
 1713  29E9           win2            EQU             *
 1714  29E9 CE42BF                    ldx             #string2
 1715  29EC BD28EE                    jsr             show
 1716                         
 1717  29EF           end             EQU             *
 1718  29EF                           %RESTORE
    /  29EF 1838                      puly
    /  29F1 38                        pulx
    /  29F2 33                        pulb
    /  29F3 32                        pula
 1719  29F4 39                        rts
 1720                 
 1721                 *=============================================
 1722                 *Subrutina turn: Recibe por stack un 1 si
 1723                 *juega el player 1 y un 0 si juega el player 2.
 1724                 *=============================================
 1725                 
 1726  29F5           turn            EQU             *
 1727  29F5                           %BACKUP
    /  29F5 36                        psha
    /  29F6 37                        pshb
    /  29F7 3C                        pshx
    /  29F8 183C                      pshy
 1728  29FA 30                        tsx
 1729  29FB A608                      ldaa            8,x
 1730  29FD 2708                      beq             p2_t
 1731                 
 1732  29FF           p1_t            EQU             *
 1733  29FF CE42C4                    ldx             #play1
 1734  2A02 BD28EE                    jsr             show
 1735  2A05 20E8                      bra             end
 1736                         
 1737  2A07           p2_t            EQU             *
 1738  2A07 CE42C9                    ldx             #play2
 1739  2A0A BD28EE                    jsr             show
 1740                 
 1741  2A0D           end_t           EQU             *
 1742  2A0D                           %RESTORE        
    /  2A0D 1838                      puly
    /  2A0F 38                        pulx
    /  2A10 33                        pulb
    /  2A11 32                        pula
 1743  2A12 39                        rts
 1744                 
 1745                 *************
 1746                 * VARIABLES *
 1747                 *************
 1748                 ***STACK***
 1749  4000                           ORG             $4000
 1750  4000           stack           RMB             600
 1751  4257           STACKP          EQU             *-1
 1752                 
 1753                 ***MAIN VARIABLES***
 1754  4258           player          RMB             1               ;variable de jugador
 1755  4259           letra_p         RMB             1
 1756  425A           num_p           RMB             1
 1757  425B           cant_sub        RMB             1
 1758  425C           cant_shi        RMB             1
 1759  425D           tot_pos         RMB             1
 1760                 
 1761                 ***KEYBOARD VARIABLES***
 1762  425E           kb_buff         RMB             1
 1763  425F           buffer          RMB             1
 1764                 
 1765  4260 20202020  string          FCC             '    '
 1766  4264 00                        FCB             0
 1767                 
 1768  4265 0A0B0CFF  kb_value        FCB             10,11,12,255,13,14,15,255,1,2,3,255,4,5,6,255
       4269 0D0E0FFF
       426D 010203FF
       4271 040506FF
 1769                 
 1770  4275 41424320  kb_ascii        FCC             'ABC DEF 123 456'
       4279 44454620
       427D 31323320
       4281 343536
 1771                 
 1772                 ***ARREGLO DE BARCOS TOCADOS***
 1773  0005           SUB             EQU             5
 1774  0004           SHI             EQU             4
 1775  0002           EL_SIZE         EQU             2
 1776  000D           MAX_ATT         EQU             SUB*1+SHI*2
 1777  001B           HITSIZE         EQU             EL_SIZE*MAX_ATT+1
 1778  4284           hitlist         RMB             HITSIZE*2
 1779                 
 1780                 ***DISPLAY MESSAGES VARIABLES***
 1781  42BA 57494E31  string1         FCC     'WIN1'
 1782  42BE 00                        FCB     00
 1783  42BF 57494E32  string2         FCC     'WIN2'
 1784  42C3 00                        FCB     00
 1785                 
 1786  42C4 2D50312D  play1           FCC     '-P1-'
 1787  42C8 00                        FCB     0
 1788  42C9 2D50322D  play2           FCC     '-P2-'
 1789  42CD 00                        FCB     0
 1790                 
 1791  42CE 5355424D  subm            FCC     'SUBM'
 1792  42D2 00                        FCB     0
 1793  42D3 43415247  carg            FCC     'CARG'
 1794  42D7 00                        FCB     0
 1795                 
 1796  42D8           arry_pr         RMB             N_PR*SA_SIZE
 1797  43A0           arry_aux        RMB             N_AUX*SA_SIZE
 1798                 
 1799  43A8 53554231  msg_sub         FCC             'SUB1'
 1800  43AC 00                        FCB             0
 1801  43AD 53554232                  FCC             'SUB2'
 1802  43B1 00                        FCB             0
 1803  43B2 53554233                  FCC             'SUB3'
 1804  43B6 00                        FCB             0
 1805  43B7 53554234                  FCC             'SUB4'
 1806  43BB 00                        FCB             0
 1807  43BC 53554235                  FCC             'SUB5'
 1808  43C0 00                        FCB             0
 1809                 
 1810  43C1 43415231  msg_shi         FCC             'CAR1'
 1811  43C5 00                        FCB             0       
 1812  43C6 43415232                  FCC             'CAR2'
 1813  43CA 00                        FCB             0       
 1814  43CB 43415233                  FCC             'CAR3'
 1815  43CF 00                        FCB             0
 1816  43D0 43415234                  FCC             'CAR4'
 1817  43D4 00                        FCB             0
 1818                 
 1819                 ***MATRICES DE TABLERO DE CADA JUGADOR***
 1820  5000                           ORG             $5000
 1821  5000 03030303  p_board         FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5004 0303
 1822  5006 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       500A 0303
 1823  500C 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5010 0303
 1824  5012 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5016 0303
 1825  5018 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       501C 0303
 1826  501E 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5022 0303
 1827                 
 1828  5024 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5028 0303
 1829  502A 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       502E 0303
 1830  5030 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5034 0303
 1831  5036 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       503A 0303
 1832  503C 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5040 0303
 1833  5042 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5046 0303
 1834                 
 1835                 ***MATRIZ DE DISPLAY***
 1836  5F00                           ORG             $5F00
 1837  5F00 03030303  display         FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5F04 0303
 1838  5F06 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5F0A 0303
 1839  5F0C 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5F10 0303
 1840  5F12 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5F16 0303
 1841  5F18 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5F1C 0303
 1842  5F1E 03030303                  FCB             WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP,WAT_NP
       5F22 0303
 1843                 
 1844                                 
 1845  5F24                           END

    Errors:  None         ###########
    Bytes:   2798         # main_bn #
    CRC:     F051         ###########

